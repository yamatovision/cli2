# LegendBrain 要件定義書

**バージョン**: 1.0.0
**最終更新日**: 2025-06-24
**ステータス**: ドラフト

## 1. プロジェクト概要

### 1.1 目的と背景

LegendBrainは、専門家や歴史上の偉人の知識・思考をクローンAIとして再現し、24時間365日利用可能な対話型コンサルティングプラットフォームです。従来、一人の専門家が直接教えられる人数には物理的な限界がありましたが、AIクローン技術により、優れた知識やスキルを持つ人々の教えを無制限に多くの人が学べるようになります。

### 1.2 ターゲットユーザー

- **事業者（クリエイター）**: 自分の専門知識や歴史上の偉人・書籍の知識をクローンAIとして提供し、新たな収益源を創出したい専門家、教育者、コンサルタント
- **個人ユーザー（学習者）**: 専門家や偉人の知識を学び、人生の悩みや専門的な課題について相談したい学習意欲の高い個人
- **開発者**: API経由でクローンAIの機能を自社システム（メール自動返信、SNS管理、カスタマーサポート等）に組み込みたい事業者

### 1.3 核となる機能と価値

以下は、プロジェクトの本質的価値を提供するために「絶対に必要」な機能です。各機能は「この機能がないとプロジェクトの目的達成が不可能になる」という基準で厳選されています。

- **クローンAI作成機能**: RAG方式によるテキストデータベース構築とAI生成 - *この機能がないと専門知識の再現ができない*
- **対話型チャット機能**: 継続的な会話と会話履歴管理 - *この機能がないと学習体験が成立しない*
- **マルチAI管理機能**: 複数のクローンAI切り替えとAI同士の議論機能 - *この機能がないとプラットフォームの差別化価値がない*
- **API提供機能**: 外部システム連携のためのRESTful API - *この機能がないと事業者の業務自動化ニーズに応えられない*
- **料金・公開設定機能**: 事業者による柔軟な収益化設定 - *この機能がないとプラットフォームビジネスが成立しない*

## 2. 画面一覧

このアプリケーションは以下の画面要素と実際のページで構成されます。各ページのモックアップは作成後に詳細化されます。

### 2.1 画面要素一覧

以下は機能的に必要な全ての画面要素です。これらは必ずしも独立したページとして実装されるわけではありません。

| 画面要素名 | 目的 | 実現する核心的価値 |
|----------|------|----------------|
| ログイン要素 | ユーザー認証 | セキュリティ確保・個人データ保護 |
| ユーザー登録要素 | 新規アカウント作成 | プラットフォーム参加の入口 |
| AI作成要素 | クローンAI作成・設定 | 事業者の価値創出 |
| データ管理要素 | テキストデータアップロード・管理 | AI学習データの品質管理 |
| チャット要素 | AI対話インターフェース | 学習・相談体験の提供 |
| AI切り替え要素 | 複数AI選択・管理 | 多様な学習体験の提供 |
| 並列対話要素 | 複数AI同時対話・議論 | 革新的な学習体験 |
| 料金設定要素 | 価格・公開範囲設定 | 事業者の収益化支援 |
| 決済要素 | 支払い処理 | プラットフォーム収益の実現 |
| API管理要素 | APIキー発行・管理 | 外部連携の実現 |

### 2.2 ページ構成計画

上記の画面要素を、ユーザー体験とナビゲーション効率を最適化するために以下のように統合・構成します。必要に応じてアクセス権限別にページをグループ化して示します。ページ動線が複雑にならないようにできるだけシンプルにまとめます。

#### 2.2.1 公開ページ

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| P-001 | ランディングページ | サービス紹介・集客 | サービス説明、AI一覧プレビュー | 高 | [landing.html](/mockups/landing.html) | 未着手 |
| P-002 | ログインページ | ユーザー認証 | ログイン要素 | 高 | [login.html](/mockups/login.html) | 未着手 |
| P-003 | ユーザー登録ページ | 新規登録 | ユーザー登録要素 | 高 | [register.html](/mockups/register.html) | 未着手 |
| P-004 | AI一覧ページ | 公開AI閲覧 | AI一覧表示、検索・フィルター | 高 | [ai-marketplace.html](/mockups/ai-marketplace.html) | 未着手 |

#### 2.2.2 個人ユーザーページ（要認証）

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| U-001 | ダッシュボード | 利用状況概要 | 最近の会話、購入AI一覧 | 高 | [user-dashboard.html](/mockups/user-dashboard.html) | 未着手 |
| U-002 | チャットページ | AI対話 | チャット要素、AI切り替え要素 | 最高 | [chat.html](/mockups/chat.html) | 未着手 |
| U-003 | 並列チャットページ | 複数AI同時対話 | 並列対話要素、AI議論機能 | 中 | [multi-chat.html](/mockups/multi-chat.html) | 未着手 |
| U-004 | 購入履歴ページ | 決済履歴管理 | 購入履歴、領収書発行 | 中 | [purchase-history.html](/mockups/purchase-history.html) | 未着手 |

#### 2.2.3 事業者ページ（要認証・事業者権限）

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| B-001 | 事業者ダッシュボード | 売上・利用状況確認 | 売上統計、AI利用状況 | 高 | [business-dashboard.html](/mockups/business-dashboard.html) | 未着手 |
| B-002 | AI作成ページ | 新規AI作成 | AI作成要素、データ管理要素 | 最高 | [ai-creation.html](/mockups/ai-creation.html) | 未着手 |
| B-003 | AI管理ページ | 既存AI管理 | AI一覧、編集・削除機能 | 高 | [ai-management.html](/mockups/ai-management.html) | 未着手 |
| B-004 | データ管理ページ | 学習データ管理 | データ管理要素、タグ・カテゴリ機能 | 高 | [data-management.html](/mockups/data-management.html) | 未着手 |
| B-005 | 料金設定ページ | 価格・公開設定 | 料金設定要素、公開範囲設定 | 高 | [pricing-settings.html](/mockups/pricing-settings.html) | 未着手 |
| B-006 | API管理ページ | API連携設定 | API管理要素、使用量確認 | 中 | [api-management.html](/mockups/api-management.html) | 未着手 |

#### 2.2.4 管理者ページ（要管理者権限）

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| A-001 | 管理ダッシュボード | プラットフォーム管理 | 全体統計、売上管理 | 高 | [admin-dashboard.html](/mockups/admin-dashboard.html) | 未着手 |
| A-002 | ユーザー管理ページ | ユーザー・事業者管理 | ユーザー一覧、権限管理 | 高 | [user-management.html](/mockups/user-management.html) | 未着手 |
| A-003 | AI審査ページ | AI公開審査 | AI審査・承認機能 | 中 | [ai-review.html](/mockups/ai-review.html) | 未着手 |

### 2.3 主要ルート定義

#### 公開ルート
| パス | ページID | 説明 |
|------|---------|------|
| `/` | P-001 | ランディングページ |
| `/login` | P-002 | ログイン |
| `/register` | P-003 | ユーザー登録 |
| `/marketplace` | P-004 | AI一覧・マーケットプレイス |

#### 個人ユーザールート（要認証）
| パス | ページID | 説明 |
|------|---------|------|
| `/dashboard` | U-001 | ユーザーダッシュボード |
| `/chat` | U-002 | AI対話 |
| `/chat/multi` | U-003 | 並列AI対話 |
| `/purchases` | U-004 | 購入履歴 |

#### 事業者ルート（要事業者権限）
| パス | ページID | 説明 |
|------|---------|------|
| `/business` | B-001 | 事業者ダッシュボード |
| `/business/ai/create` | B-002 | AI作成 |
| `/business/ai/manage` | B-003 | AI管理 |
| `/business/data` | B-004 | データ管理 |
| `/business/pricing` | B-005 | 料金設定 |
| `/business/api` | B-006 | API管理 |

#### 管理者ルート（要管理者権限）
| パス | ページID | 説明 |
|------|---------|------|
| `/admin` | A-001 | 管理ダッシュボード |
| `/admin/users` | A-002 | ユーザー管理 |
| `/admin/ai-review` | A-003 | AI審査 |

### 2.4 特殊な画面遷移

通常のナビゲーション以外の特殊な遷移のみ記載します。

- **AI購入フロー**: マーケットプレイス → 決済ページ → チャットページ
- **AI作成フロー**: AI作成 → データアップロード → 料金設定 → 公開申請
- **並列チャット起動**: チャットページ → 「AI追加」ボタン → 並列チャットページ

### 2.5 共通レイアウト構成

#### レイアウトパターン
- **公開ページ用**: ヘッダーのみ（シンプル）
- **認証後ページ用**: ヘッダー + サイドバー（機能別）
- **事業者ページ用**: ヘッダー + 事業者専用サイドバー
- **管理者ページ用**: ヘッダー + 管理者専用サイドバー

#### ヘッダー要素

##### 公開ページヘッダー
- LegendBrainロゴ
- マーケットプレイスリンク
- ログイン/登録ボタン

##### 認証後ヘッダー
- LegendBrainロゴ
- ユーザー情報表示
- 通知アイコン
- ユーザーメニュー（設定、ログアウト）

#### サイドバーメニュー

##### 個人ユーザー用サイドバー
- ダッシュボード
- AI対話
- 並列対話
- 購入履歴
- 設定

##### 事業者用サイドバー
- 事業者ダッシュボード
- AI作成
- AI管理
- データ管理
- 料金設定
- API管理
- 売上分析

##### 管理者用サイドバー
- 管理ダッシュボード
- ユーザー管理
- AI審査
- システム設定
- 売上管理

## 3. ページ詳細

このセクションでは、各ページの詳細と、それらに含まれる画面要素について説明します。

### 3.1 公開ページ

#### 3.1.1 ランディングページ (P-001)

**ページ概要**: LegendBrainサービスの紹介と新規ユーザー獲得

**含まれる画面要素**:
- ヒーローセクション: サービス価値提案
- 人気AI紹介: 注目のクローンAI一覧
- 機能紹介: AI対話、並列議論、API連携の説明
- 事業者向け案内: AI作成・収益化の説明

**状態と動作**:
- 未認証状態: 登録・ログインへの誘導
- 認証済み状態: ダッシュボードへのリダイレクト

**データとAPI**:
- 人気AI一覧: { id: string, name: string, description: string, category: string }
- `GET /api/public/featured-ais` → 注目AI一覧取得
  - リクエスト: なし
  - 成功: { success: true, data: FeaturedAI[] }
  - エラー: [500] サーバーエラー

#### 3.1.2 AI一覧ページ (P-004)

**ページ概要**: 公開されているクローンAIの検索・閲覧

**含まれる画面要素**:
- 検索・フィルター機能
- AI一覧表示（カード形式）
- カテゴリ別表示
- 料金・評価表示

**状態と動作**:
- 検索: キーワード、カテゴリ、価格帯でフィルタリング
- AI詳細: AI詳細情報の表示
- 購入: 認証後に決済フローへ遷移

**データとAPI**:
- AI検索結果: { id: string, name: string, description: string, price: number, rating: number }
- `GET /api/public/ais` → AI一覧取得
  - リクエスト: { search?: string, category?: string, priceRange?: string }
  - 成功: { success: true, data: PublicAI[], pagination: PaginationInfo }
  - エラー: [400] 無効なパラメータ

### 3.2 個人ユーザーページ

#### 3.2.1 チャットページ (U-002)

**ページ概要**: クローンAIとの対話インターフェース

**含まれる画面要素**:
- AI選択ドロップダウン
- チャット履歴表示
- メッセージ入力フォーム
- 会話履歴管理

**状態と動作**:
- AI切り替え: 選択したAIとの新しい会話開始
- メッセージ送信: リアルタイムでAI応答を表示
- 履歴管理: 過去の会話の保存・読み込み

**データとAPI**:
- チャットメッセージ: { id: string, sender: 'user' | 'ai', content: string, timestamp: Date }
- `POST /api/chat/message` → メッセージ送信
  - リクエスト: { aiId: string, message: string, conversationId?: string }
  - 成功: { success: true, data: { response: string, conversationId: string } }
  - エラー: [401] 認証エラー, [403] AI利用権限なし

### 3.3 事業者ページ

#### 3.3.1 AI作成ページ (B-002)

**ページ概要**: 新規クローンAIの作成と設定

**含まれる画面要素**:
- AI基本情報入力フォーム
- データアップロード機能
- プレビュー機能
- 公開設定

**状態と動作**:
- 基本情報入力: AI名、説明、カテゴリ設定
- データアップロード: テキストファイル、Zoom録画文字起こし
- プレビュー: 作成中AIとのテスト対話
- 保存・公開: AI作成完了と公開申請

**データとAPI**:
- AI作成データ: { name: string, description: string, category: string, isPublic: boolean }
- `POST /api/business/ais` → AI作成
  - リクエスト: CreateAIRequest
  - 成功: { success: true, data: { aiId: string } }
  - エラー: [400] バリデーションエラー, [401] 認証エラー

## 4. データモデル概要

モックアップから導出される主要データモデルを以下に示します。すべての型定義は後続フェーズで`shared/index.ts`で一元管理されます。

### 4.1 主要エンティティ

| エンティティ | 主な属性 | 関連エンティティ | 備考 |
|------------|----------|----------------|------|
| User | id, email, name, role, createdAt | Conversation, Purchase | ユーザー・事業者・管理者の共通基底 |
| AI | id, name, description, category, creatorId, isPublic, price | User, KnowledgeData, Conversation | クローンAIの基本情報 |
| KnowledgeData | id, aiId, content, tags, category, createdAt | AI | AI学習用テキストデータ |
| Conversation | id, userId, aiId, title, createdAt, updatedAt | User, AI, Message | 会話セッション |
| Message | id, conversationId, sender, content, timestamp | Conversation | 個別メッセージ |
| Purchase | id, userId, aiId, amount, status, createdAt | User, AI | AI購入履歴 |
| APIKey | id, userId, key, permissions, createdAt, lastUsed | User | API連携用キー |

## 5. 特記すべき非機能要件

以下は標準的な実装方針から特に注意すべき点です：

- **RAG方式の実装**: ファインチューニングではなく、検索拡張生成方式でクローンAIを実現
- **リアルタイム対話**: WebSocketまたはServer-Sent Eventsによる即座な応答表示
- **並列処理対応**: 複数AI同時対話時のパフォーマンス最適化
- **API レート制限**: 外部連携時の適切な使用量制限
- **データプライバシー**: 学習データの適切な暗号化と権限管理
- **スケーラビリティ**: 大量のAI作成・同時対話に対応できるアーキテクチャ

## 6. 開発計画とマイルストーン

| フェーズ | 内容 | 期間 | ステータス |
|---------|------|------|----------|
| フェーズ1 | 基本認証・ユーザー管理 | 2週間 | 未着手 |
| フェーズ2 | AI作成・データ管理機能 | 3週間 | 未着手 |
| フェーズ3 | チャット・対話機能 | 3週間 | 未着手 |
| フェーズ4 | 決済・料金設定機能 | 2週間 | 未着手 |
| フェーズ5 | API提供・外部連携 | 2週間 | 未着手 |
| フェーズ6 | 並列対話・AI議論機能 | 2週間 | 未着手 |

## 7. 添付資料

- モックアップファイル: `/mockups/` ディレクトリ内
- API仕様書: 後続フェーズで作成予定
- データベース設計書: 後続フェーズで作成予定

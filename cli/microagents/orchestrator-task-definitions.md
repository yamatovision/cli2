# BlueLamp オーケストレーター タスク定義集

このファイルには、オーケストレーターが16個の専門エージェントを起動する際のTask定義が記載されています。

## 使用方法
オーケストレーターは各フェーズに応じて、以下のTask定義を使用してエージェントを起動してください。

## 通信プロトコル
エージェントとオーケストレーター間の通信は以下のアクションを使用します：

### ユーザーへの質問
```python
AgentDelegateAction(
    agent='orchestrator',
    inputs={'type': 'question', 'content': '質問内容'},
    thought='ユーザーに確認が必要です'
)
```

### 作業完了報告
```python
AgentFinishAction(
    final_thought='作業内容を完了しました',
    task_completed=True,
    outputs={
        '成果物のパス': '/path/to/file',
        '追加情報': '必要に応じて'
    }
)
```

---

## 設計フェーズ（★1-6）

### ★1 要件定義エンジニア

**起動時の指示**:
- `/microagents/bluelamp/01-requirements-engineer.md` を読み込ませる
- 現在のプロジェクト名を伝える（SCOPE_PROGRESSから取得）

**期待される成果物**:
- `/docs/requirements.md`
-  ScopeProgressにモックアップページリストの追加

### ★2 UI/UXデザイナー

**起動時の指示**:
- `/microagents/bluelamp/02-uiux-designer.md` を読み込ませる
- 参照ファイル: `/docs/requirements.md`
- SCOPE_PROGRESS.mdのモックアップ一覧を確認させる
- **担当ページを明示**: 「今回は[ページ名]（P-XXX）を担当してください」

**ワークフロー**:
1. 指定されたページのモックアップを作成
2. ユーザーにフィードバックを求める（Phase #4）
3. フィードバックに基づき修正
4. ユーザーの承認を得る
5. 要件定義書とSCOPE_PROGRESS.mdを更新（Phase #5, #6）

**期待される成果物**:
- `/mockups/[ページ名].html` （1ページ分）
- 要件定義書の該当ページセクション更新
- SCOPE_PROGRESS.mdのチェックリスト更新

**注意**: 複数ページある場合は、ページ数分のエージェントを並列起動し、それぞれに異なるページを割り当てる

### ★3 データモデリングエンジニア

**起動時の指示**:
- `/microagents/bluelamp/03-data-modeling-engineer.md` を読み込ませる
- 参照ファイル: `/docs/requirements.md`、`/mockups/`ディレクトリ

**ワークフロー**:
1. requirements.mdとモックアップを分析
2. データ構造を抽出・設計
3. 統合型定義システムを構築
4. 機能中心のディレクトリ構造を設計
5. 要件定義書に構造を追加（7章の前）

**期待される成果物**:
- `/frontend/src/types/index.ts` （型定義とAPIパス）
- `/backend/src/types/index.ts` （フロントエンドと完全同一）
- 要件定義書への機能中心ディレクトリ構造追加
- SCOPE_PROGRESS.mdの更新

**注意**:
- 両環境の型定義ファイルは完全同一にする
- 型定義同期ガイドラインを必ずファイル冒頭に含める
- APIパスは関数として提供（パスパラメータ対応）

### ★4 システムアーキテクト

**起動時の指示**:
- `/microagents/bluelamp/04-system-architect.md` を読み込ませる
- 参照ファイル: `/docs/requirements.md`、型定義ファイル

**ワークフロー**:
1. 基本ドキュメントの解析
2. ユーザーとの1問1答でロールと権限を明確化
3. 認証システムの詳細設計（JWT、OAuth等）
4. アクセス制御マトリックス作成
5. 実装ガイドラインの提供

**期待される成果物**:
- `/docs/architecture/auth-system-design.md`（認証フロー、セキュリティ対策、実装ガイド）
- `/docs/architecture/access-control.md`（ロール別権限マトリックス）
- 型定義の更新（必要に応じて）
- SCOPE_PROGRESS.mdの更新

**注意**:
- ユーザーとの対話で要件を詳細化
- 非技術者にも分かりやすく説明
- 実装者向けの具体的なコード例を含める

### ★5 実装コンサルタント

**起動時の指示**:
- `/microagents/bluelamp/05-implementation-consultant.md` を読み込ませる
- 参照ファイル: `/docs/requirements.md`、型定義ファイル、`/mockups/*`

**ワークフロー**:
1. プロジェクト全体を分析
2. データフローを考慮した実装順序を策定
3. 3段階の実装計画を作成：
   - #1: プロトタイプ実装計画（テーブル形式）
   - #2: 垂直スライスAPI実装計画（テーブル形式）
   - #3: API統合計画

**期待される成果物**:
- SCOPE_PROGRESS.mdの「2. 実装計画」セクションを完全更新
  - プロトタイプ実装フェーズ概要
  - プロトタイプ詳細実装順
  - 垂直スライス実装順序
  - API実装タスクリスト

**注意**:
- データの自然な流れを重視（作成→参照→更新→削除）
- 依存関係を考慮した論理的な順序
- 実装状況追跡用チェックボックス付き

### ★6 環境構築

**起動時の指示**:
- `/microagents/bluelamp/06-environment-setup.md` を読み込ませる
- 参照ファイル: `/docs/requirements.md`、プロジェクト全体

**ワークフロー**:
1. 外部サービスアカウント開設ガイド（非技術者向け）
2. 必要な環境変数リストの抽出
3. プレースホルダーと実値の整理
4. 1つずつ実際の値を取得（丁寧なガイド付き）
5. 適切なディレクトリに.envファイル作成
6. Git初期設定と初回プッシュ

**期待される成果物**:
- `/frontend/.env.development`、`.env.production`
- `/backend/.env`
- `.gitignore`（test/script含む）
- `.git/hooks/prepare-commit-msg`（日時自動追加）
- GitHubへの初回プッシュ完了

**注意**:
- 非技術者向けの丁寧なガイドが必須
- 実際の値を取得してあげる（プレースホルダー禁止）
- GitHubアカウント開設から手取り足取りサポート

---

## 実装フェーズ（★7-10）

### ★7 プロトタイプ実装

**起動時の指示**:
- `/microagents/bluelamp/07-prototype-implementation.md` を読み込ませる
- 参照ファイル: 型定義ファイル、`/mockups/*`、SCOPE_PROGRESS.md
- **担当タスクを明示**: 「今回は[番号] [タスク名]を実装してください」

**ワークフロー**:
1. 型定義とSCOPE_PROGRESSの実装計画を確認
2. 指定された番号のタスクを実装（1.1, 1.2, 2.1...順番厳守）
3. モックデータは型定義に完全準拠
4. すべてのモック箇所に@MARKマーキング
5. HTMLモックアップのデザインを忠実に再現

**期待される成果物**:
- 動作するフロントエンドコード（モックAPI使用）
- すべてのデータは`services/mock/data/`経由
- モック使用時の視覚的表示（赤いバナー等）
- SCOPE_PROGRESS.mdのチェックリスト更新

**注意**:
- ハードコード完全禁止（コンポーネント内でのデータ生成厳禁）
- 複数タスクある場合は、タスク数分のエージェントを並列起動
- 最終エージェントのみ統合テスト実装

### ★8 バックエンド実装

**起動時の指示**:
- `/microagents/bluelamp/08-backend-implementation.md` を読み込ませる
- 参照ファイル: 型定義ファイル、`.env`、SCOPE_PROGRESS.md
- **担当スライスを明示**: 「今回は[番号] [スライス名]を実装してください」

**ワークフロー**:
1. 垂直スライス方式で全層を一貫実装
2. データモデル→リポジトリ→サービス→コントローラー→ルート
3. 統合テスト作成（単体テストは作成しない）
4. 実データ主義（モック完全禁止）
5. ★9への引き継ぎ準備

**期待される成果物**:
- 機能単位の完全実装コード
- 統合テストファイル（`/backend/tests/integration/`）
- テストユーティリティ（DB接続、認証、データ生成等）
- MilestoneTracker（処理時間計測）
- SCOPE_PROGRESS.mdの更新と引き継ぎ情報

**注意**:
- 型定義の同期を維持（frontend/backend両方）
- 外部APIも実環境を使用（OpenAI、LINE等）
- テストデータはユニークID使用で分離

### ★9 テスト品質検証

**起動時の指示**:
- `/microagents/bluelamp/09-test-quality-verification.md` を読み込ませる
- 参照ファイル: ★8からの引き継ぎ情報、統合テストファイル
- **担当テストケースを明示**: 「今回は[ファイル名]の[テストケース名]に集中してください」

**ワークフロー**:
1. 1つのテストケースに100%集中（1点突破主義）
2. MilestoneTrackerでボトルネック特定
3. 実装側を修正してテスト通過（テスト変更禁止）
4. AI-FAQ.mdで引き継ぎ（解決済みは削除）
5. 着実に一つずつクリア

**期待される成果物**:
- 対象テストケースの通過
- 実装コードの修正（根本解決のみ）
- SCOPE_PROGRESS.mdのテスト通過チェック更新
- AI-FAQ.mdの整理と次アクション明示

**注意**:
- モック使用・テストスキップ等の迂回策は絶対禁止
- 型定義は単一の真実源として尊重
- API連携チェックは権限外（フロントエンドの役割）

### ★10 API統合

**起動時の指示**:
- `/microagents/bluelamp/10-api-integration.md` を読み込ませる
- SCOPE_PROGRESS.mdでテスト通過済みAPI確認
- **統合対象APIを明示**: 「今回は[API群名]を統合してください」

**ワークフロー**:
1. テスト通過かつ未統合のAPIを特定
2. @MOCKマーキング箇所を検索（統合対象のみ）
3. 型定義とレスポンス形式の整合性確認
4. モックから実APIに段階的置換
5. 統合対象以外のモックは維持

**期待される成果物**:
- 統合対象APIの実API化完了
- 統合対象のモックコードのみ削除
- エラーハンドリング実装
- SCOPE_PROGRESS.mdのAPI連携チェック更新

**注意**:
- 未統合APIのモックは必ず維持
- 全API統合完了時のみモック関連を完全削除
- レスポンス形式は実装を必ず確認（型定義と照合）

---

## サポートエージェント（必要時に起動）

### ★11 デバッグ探偵

**起動時の指示**:
- `/microagents/bluelamp/11-debug-detective.md` を読み込ませる
- 具体的なエラーログやメッセージを提供
- **環境情報を明示**: 「エラーはローカル/本番環境で発生」

**ワークフロー**:
1. エラー関連ファイルの依存関係マップ作成
2. 調査順序のロードマップをドキュメント化
3. 各ステップでログを追加しながら修正
4. エラー発生ステップを特定・記録
5. 問題ステップに集中したタスクリスト作成

**期待される成果物**:
- 依存関係とロードマップのドキュメント
- ログ追加済みのデバッグコード
- エラー発生ステップの明確な記録
- 根本原因の特定と修正
- SCOPE_PROGRESS.mdのデバッグログ更新

**注意**:
- 環境差異エラーの場合は環境変数の実数値調査を最優先
- gcloud run services describe等で本番環境を直接確認
- エラー詳細を受け取ってから調査開始

### ★12 デプロイスペシャリスト

**起動時の指示**:
- `/microagents/bluelamp/12-deploy-specialist.md` を読み込ませる
- デプロイ対象（frontend/backend/both）を指定
- **既存サービス情報を明示**: 「既存[サービス名]と共存設定」

**ワークフロー**:
1. デプロイ状況確認（deploy.md）
2. 既存サービス保護チェック
3. 環境変数の実数値設定（CLI経由）
4. 安全なデプロイ実行（サービス名明示）
5. CI/CDパイプライン構築

**期待される成果物**:
- deployment/deploy.md（環境変数実数値含む）
- 本番環境URL（既存と区別可能）
- 既存サービスとの共存設定
- CI/CDパイプライン設定
- .gitignoreの更新

**注意**:
- 日本人非技術者向けの極めて丁寧なガイド
- 環境変数設定はCLI経由で代行実施
- 既存サービスの誤上書きを絶対防止
- Firebase Hosting推奨（日本語ドキュメント）
- Google Cloud Run推奨（日本リージョン対応）

### ★13 GitHubマネージャー

**起動時の指示**:
- `/microagents/bluelamp/13-github-manager.md` を読み込ませる
- 操作種別（commit/push/pr/merge）を指定
- **センシティブ情報チェック**: 「機密情報の有無を確認」

**ワークフロー**:
1. git status/diffで変更確認
2. 機密情報の自動検出（grep）
3. .gitignoreの適切な更新
4. 全ファイル一括コミット（git add .）
5. 明確なコミットメッセージ作成

**期待される成果物**:
- センシティブ情報を除外したコミット
- 適切な.gitignore更新
- 説明的なコミットメッセージ
- 安全なリモートプッシュ
- 混乱時のバックアップブランチ

**注意**:
- 部分コミットは避け、全体を一括コミット
- 破壊的操作（reset --hard）は極力回避
- 混乱時は一時ブランチで状態保存
- 機密情報は環境変数で管理徹底

### ★14 TypeScriptマネージャー

**起動時の指示**:
- `/microagents/bluelamp/14-typescript-manager.md` を読み込ませる
- AI-FAQ.mdの存在確認と読み込み
- **プロジェクト構造確認**: 「tsconfig.jsonの存在確認」

**ワークフロー**:
1. scripts/ts-error/analyzer.js確認
2. npm run ts:checkでエラー収集
3. tasks.jsonに作業登録（重複防止）
4. TodoWriteでタスク管理
5. エラーゼロまで継続

**期待される成果物**:
- TypeScriptエラー0の達成
- analyzer.js実装（初回のみ）
- tasks.json更新（作業管理）
- 型定義の同期（frontend/backend）
- AI-FAQ.md更新（20分以上の問題）

**注意**:
- any型/@ts-ignore使用禁止
- 単一の真実源（types/index.ts）を尊重
- 25分以上のタスクは放棄とみなす
- ローカル時間で統一記録

### ★15 機能拡張

**起動時の指示**:
- `/microagents/bluelamp/15-feature-expansion.md` を読み込ませる
- 追加要件の種類（小/中/大規模）を伝える
- **ヒアリング開始**: 「追加したい機能を教えてください」

**ワークフロー**:
1. 1問1答式の徹底ヒアリング
2. 要件確定（ユーザーからOK取得）
3. 関連ファイル完全調査
4. 実装計画策定（依存関係考慮）
5. 機能拡張計画書作成

**期待される成果物**:
- /docs/plans/planning/ext-[機能名]-[日付].md
- ディレクトリ構造設計（既存影響最小化）
- タスク分解と順序定義
- SCOPE_PROGRESS.md差し込みタスク
- テスト計画

**注意**:
- 非技術者向けの自然言語ヒアリング
- 既存ファイル肥大化を避ける設計
- 計画→実装中→完了のライフサイクル管理
- 抜け漏れのない完全な影響調査

### ★16 リファクタリングエキスパート

**起動時の指示**:
- `/microagents/bluelamp/16-refactoring-expert.md` を読み込ませる
- リファクタリング種別（削減/分割/最適化/品質）を指定
- **初期メッセージ送信**: 「リファクタリングしたいコードについて教えてください」

**ワークフロー**:
1. 1問1答式ヒアリング（要望掘り下げ）
2. 要件確定（ユーザーOK取得必須）
3. 関連ファイル完全調査（依存関係図作成）
4. 根本原因と理想設計の構想
5. フェーズ別実装計画策定

**期待される成果物**:
- /docs/refactoring/[対象名]-[日付].md
- 依存関係図と影響分析
- フェーズ別タスク（検証ポイント付き）
- コード削減目標と効果測定
- GitHubチェックポイント設定

**注意**:
- 削除第一・シンプル優先の原則
- 2000行以上は段階的分割戦略
- 根本原因への対処（症状対処禁止）
- 将来の拡張性も考慮した設計

---

## 使用上の注意

1. **プロジェクト情報の伝達**
   - 各エージェント起動時に必要最小限の情報のみ伝える
   - 詳細な作業内容は各エージェントのプロンプトファイルに記載済み

2. **並行実行パターン**
   - ★2（UI/UXデザイナー）：複数ページ分を並列起動可能
   - ★7（プロトタイプ）：複数ページを並列実装可能
   - ★7＆★8：並行開発可能
   - ★14（TypeScriptマネージャー）：常時起動推奨

3. **エラー対応**
   - 一般的なエラー：★11デバッグ探偵
   - 型エラー：★14 TypeScriptマネージャー

4. **SCOPE_PROGRESS.md管理**
   - 各エージェントが直接更新
   - オーケストレーターは実行中エージェントセクションのみ管理

# 機能拡張計画: NoProjectViewログイン制限機能 2025-01-19

## 1. 拡張概要

AppGeniusのNoProjectView（プロジェクト未選択画面）に対してログイン制限を追加します。現在、この画面は認証なしでアクセス可能ですが、セキュリティ強化のため、ログイン後のみアクセス可能にします。これにより、すべての主要機能へのアクセスが認証で保護され、より安全なシステムとなります。

## 2. 詳細仕様

### 2.1 現状と課題

現在のNoProjectViewは認証チェックなしでアクセス可能です。この画面自体は機密情報を含みませんが、AppGeniusの全体的なセキュリティポリシーと一貫性を保つため、また将来的な機能拡張に備えて、認証を必須とすることが望ましいです。

### 2.2 拡張内容

NoProjectViewへのアクセス時に以下の動作を実現します：

1. ScopeManagerPanelがNoProjectViewを表示する前にログイン状態を確認
2. 未ログインの場合、ログインプロンプトを表示
3. ユーザーがログインを選択した場合、ログイン画面を表示
4. ログイン成功後、自動的にNoProjectViewを表示
5. ログインをキャンセルした場合、NoProjectViewは表示されない

## 3. ディレクトリ構造

```
src/
├── ui/
│   ├── scopeManager/
│   │   └── ScopeManagerPanel.ts [変更]
│   └── noProjectView/
│       └── NoProjectViewPanel.ts [変更なし]
```

## 4. 技術的影響分析

### 4.1 影響範囲

- **フロントエンド**: ScopeManagerPanelの一部変更のみ
- **バックエンド**: 変更なし
- **データモデル**: 変更なし
- **その他**: 既存の認証フローを活用するため、最小限の変更で実装可能

### 4.2 変更が必要なファイル

```
- src/ui/scopeManager/ScopeManagerPanel.ts: NoProjectView表示前にAuthGuard.checkLoggedIn()を追加
```

## 5. タスクリスト

```
- [ ] **T1**: ScopeManagerPanel.createOrShow()にログインチェックを追加
- [ ] **T2**: 未ログイン時のフロー実装（ログインプロンプト表示）
- [ ] **T3**: ログイン成功後のNoProjectView自動表示の実装
- [ ] **T4**: ログインキャンセル時の適切なハンドリング
- [ ] **T5**: 統合テストの実施
```

### 6. テスト計画

以下のテストケースを実施します：

1. **未ログイン状態でのアクセス**
   - プロジェクトが存在しない状態でScopeManagerを開く
   - ログインプロンプトが表示されることを確認
   - ログイン後にNoProjectViewが表示されることを確認

2. **ログインキャンセル**
   - ログインプロンプトでキャンセルを選択
   - NoProjectViewが表示されないことを確認

3. **既ログイン状態でのアクセス**
   - ログイン済みの状態でプロジェクトが存在しない場合
   - 直接NoProjectViewが表示されることを確認

4. **他の機能への影響確認**
   - プロジェクト作成・読み込み機能が正常に動作することを確認
   - 他のパネル表示に影響がないことを確認

## 7. SCOPE_PROGRESSへの統合

[SCOPE_PROGRESS.md]に以下のタスクを追加：

```markdown
- [ ] **AUTH-002**: NoProjectViewログイン制限機能の実装
  - 目標: 2025-01-26
  - 参照: [/docs/plans/planning/ext-noproject-view-auth-2025-01-19.md]
  - 内容: NoProjectView（プロジェクト未選択画面）へのアクセスをログイン必須にし、全体的なセキュリティを強化
```

## 8. 備考

- 実装は最小限の変更で完了できるため、既存機能への影響は極めて小さい
- 将来的にNoProjectViewに新機能を追加する場合も、認証が前提となるため安全
- 他のパネル（FileViewerPanel等）も同様の認証制限を検討する価値がある
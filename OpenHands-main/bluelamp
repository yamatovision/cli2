#!/bin/bash

# BlueLamp - OpenHands wrapper script
# OpenHandsのインタラクティブモードを起動するラッパースクリプト

# スクリプトの実際のパスを解決（シンボリックリンクの場合も対応）
if [ -L "$0" ]; then
    # シンボリックリンクの場合、実際のパスを取得
    SCRIPT_PATH="$(readlink "$0")"
else
    SCRIPT_PATH="$0"
fi

# スクリプトのディレクトリを取得
SCRIPT_DIR="$(dirname "$SCRIPT_PATH")"

# 現在のディレクトリを保存（実行した場所をワークスペースとする）
CURRENT_DIR="$(pwd)"

# デバッグ用の環境変数設定
export DEBUG=1
export ANTHROPIC_LOG=debug

# OpenHandsのパスを環境変数に設定
export PYTHONPATH="$SCRIPT_DIR:$PYTHONPATH"

# Python実行環境の確認と起動（現在のディレクトリから実行）
if command -v poetry &> /dev/null; then
    # Poetryが利用可能な場合
    cd "$SCRIPT_DIR" || exit 1
    poetry run python -m openhands.cli.main \
        -f "$SCRIPT_DIR/task_greeting.txt" \
        --config-file "$SCRIPT_DIR/config.toml" \
        --workspace-dir "$CURRENT_DIR"
else
    # Poetryがない場合は直接Python実行
    cd "$SCRIPT_DIR" || exit 1  
    python -m openhands.cli.main \
        -f "$SCRIPT_DIR/task_greeting.txt" \
        --config-file "$SCRIPT_DIR/config.toml" \
        --workspace-dir "$CURRENT_DIR"
fi

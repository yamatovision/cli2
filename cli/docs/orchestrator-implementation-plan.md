# BlueLamp ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…è¨ˆç”»æ›¸

**ä½œæˆæ—¥**: 2025-01-24
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨ˆç”»æ®µéš

## 1. æ¦‚è¦

### 1.1 ç›®çš„
ç¾åœ¨ã®BlueLamp CLIã®å˜ä¸€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–¹å¼ã‹ã‚‰ã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä¸­å¿ƒã¨ã—ãŸãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–¹å¼ã¸ç§»è¡Œã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¤‡æ•°ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä¸¦åˆ—ãƒ»å”èª¿çš„ã«å‹•ä½œã•ã›ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ãªé–‹ç™ºæ”¯æ´ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### 1.2 ä¸»è¦ãªå¤‰æ›´ç‚¹
- BlueLampèµ·å‹•æ™‚ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒæœ€åˆã«ç™»å ´
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±çª“å£ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ä¸€æœ¬åŒ–
- 16å€‹ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¿…è¦ã«å¿œã˜ã¦èµ·å‹•ãƒ»ç®¡ç†
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®é€šä¿¡ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã®å®Ÿè£…

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ â”‚ â† æ–°è¦å®Ÿè£…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç† â”‚
â”‚ - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸­ç¶™  â”‚
â”‚ - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚è¦ä»¶å®šç¾©â”‚ â”‚ UI/UX â”‚ â”‚ãƒ‡ãƒ¼ã‚¿ â”‚ â”‚ ... â”‚
â”‚ã‚¨ãƒ¼ã‚¸ã‚§â”‚ â”‚ãƒ‡ã‚¶ã‚¤ãƒŠâ”‚ â”‚ãƒ¢ãƒ‡ãƒªãƒ³ã‚°â”‚ â”‚16å€‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› â†’ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
2. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ â†’ é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ¯ã‚Šåˆ†ã‘
3. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ â†’ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆçµæœãƒ»è³ªå•ï¼‰
4. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆçµ±åˆã•ã‚ŒãŸå¿œç­”ï¼‰

## 3. å®Ÿè£…å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### 3.1 æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

#### 3.1.1 ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæœ¬ä½“
```
/openhands/agenthub/orchestrator/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ orchestrator_agent.py
â””â”€â”€ prompts/
    â””â”€â”€ system_prompt.j2
```

#### 3.1.2 ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ãƒã‚¤ã‚¯ãƒ­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
```
/microagents/bluelamp/
â””â”€â”€ 00-orchestrator.md  # ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
```

#### 3.1.3 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
```
/openhands/orchestrator/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent_manager.py      # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
â”œâ”€â”€ session_manager.py    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”œâ”€â”€ message_router.py     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â””â”€â”€ context_manager.py    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
```

### 3.2 ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

#### 3.2.1 ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«
- **`/openhands/cli/main.py`**
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’OrchestratorAgentã«å¤‰æ›´
  - åˆæœŸåŒ–å‡¦ç†ã®ä¿®æ­£

#### 3.2.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- **`/config.toml`**
  ```toml
  [agent]
  default_agent = "OrchestratorAgent"  # CodeActAgent ã‹ã‚‰å¤‰æ›´

  [orchestrator]
  max_parallel_agents = 10  # 5ã‹ã‚‰10ã«å¢—åŠ 
  agent_timeout = 300  # seconds
  enable_agent_sleep = true
  sleep_after_minutes = 15
  ```

#### 3.2.3 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç™»éŒ²
- **`/openhands/agenthub/__init__.py`**
  - OrchestratorAgentã®ç™»éŒ²è¿½åŠ 

#### 3.2.4 UI/è¡¨ç¤ºé–¢é€£
- **`/openhands/cli/tui.py`**
  - ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ã®è¡¨ç¤ºé–¢æ•°è¿½åŠ 
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º

#### 3.2.5 ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
- **`/openhands/cli/commands.py`**
  - ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å°‚ç”¨ã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 
  - `/status`: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¸€è¦§ã¨é€²æ—çŠ¶æ³
  - `/talk [agent]`: ç‰¹å®šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®å¯¾è©±
  - `/close [agent]`: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çµ‚äº†
  - `/auto`: å®Œå…¨è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã®é–‹å§‹ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†ã¾ã§ï¼‰
  - `/pause`: è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã®ä¸€æ™‚åœæ­¢
  - `/resume`: å‡¦ç†ã®å†é–‹
  - `/progress`: SCOPE_PROGRESS.mdã®ç¾åœ¨çŠ¶æ…‹ã‚’è¡¨ç¤º

## 4. è©³ç´°ãªå¤‰æ›´å†…å®¹

### 4.1 OrchestratorAgentå®Ÿè£…

```python
# /openhands/agenthub/orchestrator/orchestrator_agent.py

class OrchestratorAgent(Agent):
    """BlueLampã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    def __init__(self, llm: LLM, config: AgentConfig):
        super().__init__(llm, config)
        self.agent_manager = AgentManager()
        self.session_manager = SessionManager()
        self.message_router = MessageRouter()
        self.active_agents = {}
        self.autonomous_mode = False  # è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰
        self.pause_requested = False  # ä¸€æ™‚åœæ­¢ãƒ•ãƒ©ã‚°

    def step(self, state: State) -> Action:
        """ãƒ¡ã‚¤ãƒ³ã®å‡¦ç†ãƒ«ãƒ¼ãƒ—"""
        # 0. ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šè¾¼ã¿ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€å„ªå…ˆï¼‰
        if self._check_user_interrupt(state):
            return self._handle_interrupt(state)

        # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’è§£æ
        user_input = state.inputs.get("message", "")

        # 2. ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
        if user_input.startswith("/"):
            return self._handle_command(user_input)

        # 3. è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
        if self.autonomous_mode and not user_input:
            return self._autonomous_step(state)

        # 4. é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ¯ã‚Šåˆ†ã‘
        target_agent = self._determine_target_agent(user_input)

        # 5. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæœªèµ·å‹•ãªã‚‰èµ·å‹•
        if target_agent not in self.active_agents:
            self._launch_agent(target_agent)

        # 6. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è»¢é€
        return self._delegate_to_agent(target_agent, user_input)

    def _check_user_interrupt(self, state: State) -> bool:
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šè¾¼ã¿ã‚’ãƒã‚§ãƒƒã‚¯"""
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä»»æ„ã®å…¥åŠ›ãŒã‚ã‚Œã°å‰²ã‚Šè¾¼ã¿ã¨ã—ã¦æ‰±ã†
        return bool(state.inputs.get("message")) and self.autonomous_mode

    def _handle_interrupt(self, state: State) -> Action:
        """å‰²ã‚Šè¾¼ã¿å‡¦ç†"""
        self.autonomous_mode = False

        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ã‚’ä¿å­˜
        self._save_all_agent_states()

        return MessageAction(
            content=f"""
ğŸ›‘ **å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ**

ç¾åœ¨ã®çŠ¶æ…‹ï¼š
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: {len(self.active_agents)}å€‹
- é€²è¡Œä¸­ã®ã‚¿ã‚¹ã‚¯: {self._get_active_tasks_summary()}

ä½•ã‹ã”æŒ‡ç¤ºã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
ï¼ˆä½•ã‚‚å…¥åŠ›ã›ãšã«Enterã§è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã‚’å†é–‹ã—ã¾ã™ï¼‰
"""
        )
```

### 4.2 AgentManagerå®Ÿè£…

```python
# /openhands/orchestrator/agent_manager.py

class AgentManager:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†"""

    def __init__(self):
        self.agents = {}
        self.agent_states = {}  # active, sleeping, closed

    def launch_agent(self, agent_type: str, session_id: str) -> AgentController:
        """æ–°ã—ã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•"""
        # ç‹¬ç«‹ã—ãŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆ
        runtime = create_runtime(
            config=self.config,
            sid=f"{session_id}-{agent_type}"
        )
        agent = create_agent(agent_type, self.config)
        controller = AgentController(agent, runtime)

        self.agents[agent_type] = {
            'controller': controller,
            'runtime': runtime,
            'state': 'active',
            'last_activity': datetime.now()
        }

        return controller

    def sleep_agent(self, agent_type: str):
        """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã«"""
        # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾

    def wake_agent(self, agent_type: str):
        """ã‚¹ãƒªãƒ¼ãƒ—ä¸­ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·åºŠ"""
        # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¾©å…ƒ
```

### 4.3 SessionManagerå®Ÿè£…

```python
# /openhands/orchestrator/session_manager.py

class SessionManager:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç®¡ç†"""

    def __init__(self):
        self.sessions = {}

    def create_session(self, agent_type: str) -> str:
        """æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ"""
        session_id = f"{agent_type}-{uuid.uuid4()}"
        self.sessions[session_id] = {
            'agent_type': agent_type,
            'created_at': datetime.now(),
            'context': [],
            'status': 'active'
        }
        return session_id

    def save_context(self, session_id: str, context: List[Event]):
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜"""
        # Condenserã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§ç¸®
```

### 4.4 MessageRouterå®Ÿè£…ï¼ˆè‡ªå¾‹çš„AIåˆ¤æ–­æ©Ÿèƒ½ä»˜ãï¼‰

```python
# /openhands/orchestrator/message_router.py

class MessageRouter:
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆè‡ªå¾‹çš„AIåˆ¤æ–­æ©Ÿèƒ½ä»˜ãï¼‰"""

    def __init__(self, llm: LLM):
        self.llm = llm
        self.routing_rules = self._load_routing_rules()
        self.agent_capabilities = self._load_agent_capabilities()

    def determine_target(self, message: str, scope_progress: dict, active_agents: dict) -> str:
        """AIåˆ¤æ–­ã«ã‚ˆã‚Šå¯¾è±¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è‡ªå¾‹çš„ã«æ±ºå®š"""

        # 1. æ˜ç¤ºçš„ãªæŒ‡ç¤ºãŒã‚ã‚‹å ´åˆ
        explicit_agent = self._check_explicit_instruction(message)
        if explicit_agent:
            return explicit_agent

        # 2. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
        keyword_agent = self._keyword_based_routing(message)
        if keyword_agent:
            return keyword_agent

        # 3. AIåˆ¤æ–­ã«ã‚ˆã‚‹è‡ªå¾‹çš„ãªæ±ºå®š
        return self._ai_based_routing(message, scope_progress, active_agents)

    def _ai_based_routing(self, message: str, scope_progress: dict, active_agents: dict) -> str:
        """AIã‚’ä½¿ç”¨ã—ãŸè‡ªå¾‹çš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé¸æŠ"""

        prompt = f"""
        ## ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³

        ### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        {message}

        ### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ï¼ˆSCOPE_PROGRESS.mdï¼‰
        {json.dumps(scope_progress, ensure_ascii=False, indent=2)}

        ### ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
        {json.dumps(active_agents, ensure_ascii=False, indent=2)}

        ### åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨èƒ½åŠ›
        {json.dumps(self.agent_capabilities, ensure_ascii=False, indent=2)}

        ## ã‚¿ã‚¹ã‚¯
        ä¸Šè¨˜ã®æƒ…å ±ã‚’åŸºã«ã€æ¬¡ã«èµ·å‹•ã™ã¹ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚

        åˆ¤æ–­åŸºæº–ï¼š
        1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º
        2. æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯
        3. ä¾å­˜é–¢ä¿‚ï¼ˆå‰ææ¡ä»¶ï¼‰
        4. ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½æ€§
        5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³

        å›ç­”å½¢å¼ï¼š
        {
            "agent": "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå",
            "reason": "é¸æŠç†ç”±",
            "parallel_candidates": ["ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ãªä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"],
            "next_steps": ["ä»Šå¾Œã®æ¨å¥¨ã‚¹ãƒ†ãƒƒãƒ—"]
        }
        """

        response = self.llm.completion(
            messages=[
                {"role": "system", "content": "ã‚ãªãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã®å°‚é–€å®¶ã§ã™ã€‚"},
                {"role": "user", "content": prompt}
            ],
            response_format={"type": "json_object"}
        )

        decision = json.loads(response.choices[0].message.content)

        # ä¸¦åˆ—å®Ÿè¡Œã®åˆ¤æ–­
        if decision.get("parallel_candidates"):
            self._schedule_parallel_agents(decision["parallel_candidates"])

        return decision["agent"]

    def _load_agent_capabilities(self) -> Dict[str, Dict]:
        """å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èƒ½åŠ›ã¨å‰ææ¡ä»¶ã‚’å®šç¾©"""
        return {
            "RequirementsEngineerAgent": {
                "capabilities": ["è¦ä»¶å®šç¾©", "æ©Ÿèƒ½ä»•æ§˜ä½œæˆ", "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼"],
                "prerequisites": [],
                "phase": "planning"
            },
            "UIUXDesignerAgent": {
                "capabilities": ["ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ", "ç”»é¢è¨­è¨ˆ", "UIè¨­è¨ˆ"],
                "prerequisites": ["è¦ä»¶å®šç¾©å®Œäº†"],
                "phase": "design"
            },
            "DataModelingAgent": {
                "capabilities": ["ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ", "ã‚¹ã‚­ãƒ¼ãƒå®šç¾©", "å‹å®šç¾©"],
                "prerequisites": ["è¦ä»¶å®šç¾©å®Œäº†"],
                "phase": "design"
            },
            "SystemArchitectAgent": {
                "capabilities": ["èªè¨¼è¨­è¨ˆ", "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ", "ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ"],
                "prerequisites": ["è¦ä»¶å®šç¾©å®Œäº†"],
                "phase": "design"
            },
            "ImplementationConsultantAgent": {
                "capabilities": ["å®Ÿè£…è¨ˆç”»", "ã‚¿ã‚¹ã‚¯åˆ†è§£", "å„ªå…ˆé †ä½ä»˜ã‘"],
                "prerequisites": ["è¨­è¨ˆå®Œäº†"],
                "phase": "planning"
            },
            "PrototypeImplementationAgent": {
                "capabilities": ["ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…", "ãƒ¢ãƒƒã‚¯APIå®Ÿè£…"],
                "prerequisites": ["ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†", "å‹å®šç¾©å®Œäº†"],
                "phase": "implementation"
            },
            "BackendImplementationAgent": {
                "capabilities": ["APIå®Ÿè£…", "ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š"],
                "prerequisites": ["ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®Œäº†", "èªè¨¼è¨­è¨ˆå®Œäº†"],
                "phase": "implementation"
            },
            # ... ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
        }
```

### 4.5 UIè¡¨ç¤ºã®ä¿®æ­£

```python
# /openhands/cli/tui.py ã«è¿½åŠ 

def display_orchestrator_status(active_agents: Dict[str, Dict]) -> None:
    """ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º"""
    print_formatted_text(HTML('<cyan>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</cyan>'))
    print_formatted_text(HTML('<cyan>BlueLamp ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼</cyan>'))
    print_formatted_text(HTML('<cyan>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</cyan>'))

    print_formatted_text(HTML('<yellow>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ:</yellow>'))
    for agent_type, info in active_agents.items():
        status_icon = get_status_icon(info['state'])
        last_activity = format_time_ago(info['last_activity'])
        print_formatted_text(
            HTML(f'  {status_icon} {agent_type} - {info["state"]} ({last_activity})')
        )

    print_formatted_text(HTML('<cyan>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</cyan>'))

def get_status_icon(state: str) -> str:
    """ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—"""
    icons = {
        'active': 'ğŸŸ¢',
        'working': 'âš¡',
        'waiting': 'ğŸŸ¡',
        'sleeping': 'ğŸ˜´',
        'completed': 'âœ…',
        'closed': 'âŒ'
    }
    return icons.get(state, 'â“')
```

## 5. å®Ÿè£…æ‰‹é †

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ1-2æ—¥ï¼‰
1. OrchestratorAgentåŸºæœ¬ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
2. AgentManager, SessionManager, MessageRouterã®åŸºæœ¬å®Ÿè£…
3. config.tomlã®æ›´æ–°

### Phase 2: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†ï¼ˆ2-3æ—¥ï¼‰
1. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èµ·å‹•ãƒ»çµ‚äº†æ©Ÿèƒ½
2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½
3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½

### Phase 3: UI/UXæ”¹å–„ï¼ˆ1-2æ—¥ï¼‰
1. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å°‚ç”¨UI
2. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
3. ã‚³ãƒãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

### Phase 4: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ2-3æ—¥ï¼‰
1. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é€£æºãƒ†ã‚¹ãƒˆ
2. ä¸¦åˆ—å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Phase 5: æœ€é©åŒ–ï¼ˆ1-2æ—¥ï¼‰
1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
2. ãƒ¡ãƒ¢ãƒªç®¡ç†ã®æœ€é©åŒ–
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 6.1 å˜ä½“ãƒ†ã‚¹ãƒˆ
- OrchestratorAgentã®åŸºæœ¬å‹•ä½œ
- å„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¯ãƒ©ã‚¹ã®æ©Ÿèƒ½
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç²¾åº¦

### 6.2 çµ±åˆãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®é€šä¿¡
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ°¸ç¶šæ€§
- ã‚¨ãƒ©ãƒ¼æ™‚ã®å¾©æ—§

### 6.3 ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
- è¦ä»¶å®šç¾© â†’ ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆãƒ•ãƒ­ãƒ¼
- ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çµ‚äº†ã¨å†èµ·å‹•

## 7. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 7.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯
| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– |
|--------|--------|------|
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å¢—å¤§ | é«˜ | Condenserã®æ´»ç”¨ã€ã‚¹ãƒªãƒ¼ãƒ—æ©Ÿèƒ½ |
| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ç«¶åˆ | ä¸­ | æ’ä»–åˆ¶å¾¡ã€ãƒªã‚½ãƒ¼ã‚¹ç®¡ç† |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | ä¸­ | éåŒæœŸå‡¦ç†ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |

### 7.2 å®Ÿè£…ä¸Šã®èª²é¡Œ
- æ—¢å­˜ã®CodeActAgentã¨ã®äº’æ›æ€§ç¶­æŒ
- ãƒã‚¤ã‚¯ãƒ­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¤‡é›‘åŒ–

## 8. ä»Šå¾Œã®æ¤œè¨äº‹é …

### 8.1 ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†ã®æŒ‡é‡
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾è©±ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾å¿œæ–¹æ³•

### 8.2 æ‹¡å¼µæ©Ÿèƒ½
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è‡ªå‹•é¸æŠAI
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- é€²æ—ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½

## 9. æˆåŠŸæŒ‡æ¨™

- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆæ™‚é–“: 3ç§’ä»¥å†…
- ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°: 10å€‹ä»¥ä¸Šï¼ˆè¨­å®šå€¤ã«æ›´æ–°ï¼‰
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ç¾è¡Œæ¯”200%ä»¥å†…ï¼ˆä¸¦åˆ—æ•°å¢—åŠ ã«å¯¾å¿œï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦: å‘ä¸Š
- è‡ªå¾‹çš„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•æˆåŠŸç‡: 80%ä»¥ä¸Š

## 10. æ°¸ç¶šã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå®Ÿè£…ï¼ˆ2025-01-24è¿½åŠ ï¼‰

### 10.1 OrchestratorCondenserå®Ÿè£…

ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å°‚ç”¨ã®Condenserã‚’å®Ÿè£…ã—ã€é•·æœŸçš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚’å®Ÿç¾ï¼š

```python
# /openhands/memory/condenser/impl/orchestrator_condenser.py

class OrchestratorCondenser(RollingCondenser):
    """ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å°‚ç”¨ã®Condenser"""

    def __init__(self, llm: LLM, max_size: int = 200, keep_first: int = 10):
        super().__init__(llm, max_size, keep_first)
        self.agent_summaries = {}

    def get_condensation(self, view: View) -> Condensation:
        # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ã®æ´»å‹•ã‚’è¦ç´„
        agent_summaries = self._summarize_by_agent(view)

        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®é€²æ—ã‚’è¦ç´„
        project_summary = self._summarize_project_progress(view)

        # é‡è¦ãªæ±ºå®šäº‹é …ã‚’ä¿æŒ
        key_decisions = self._extract_key_decisions(view)

        # SCOPE_PROGRESS.mdã®çŠ¶æ…‹ã‚‚å«ã‚ã‚‹
        scope_progress = self._get_scope_progress_summary()

        summary = self._generate_summary(
            agent_summaries,
            project_summary,
            key_decisions,
            scope_progress
        )

        return Condensation(
            action=CondensationAction(
                summary=summary,
                metadata={
                    'agent_states': self._get_agent_states(view),
                    'scope_progress': scope_progress
                }
            )
        )
```

### 10.2 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æ‹¡å¼µ

```python
# /openhands/orchestrator/agent_session_manager.py

class AgentSessionManager:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆæ°¸ç¶šåŒ–å¯¾å¿œï¼‰"""

    def __init__(self, file_store: FileStore, llm: LLM):
        self.file_store = file_store
        self.llm = llm
        self.sessions = {}
        self.condensers = {}  # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥Condenser

    def create_agent_session(self, agent_type: str, parent_sid: str) -> str:
        """æ–°ã—ã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ"""
        sid = f"{parent_sid}-{agent_type}-{uuid.uuid4()}"

        # ç‹¬ç«‹ã—ãŸEventStreamã‚’ä½œæˆ
        event_stream = EventStream(sid, self.file_store)

        # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå°‚ç”¨ã®Condenser
        condenser = LLMSummarizingCondenser(
            llm=self.llm,
            max_size=50,  # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”¨ã¯å°ã•ã‚
            keep_first=5
        )

        # æ—¢å­˜ã®è¦ç´„ãŒã‚ã‚Œã°å¾©å…ƒ
        existing_summary = self._load_agent_summary(agent_type)

        self.sessions[agent_type] = {
            'sid': sid,
            'event_stream': event_stream,
            'state': State(session_id=sid),
            'last_activity': datetime.now(),
            'context_summary': existing_summary
        }

        self.condensers[agent_type] = condenser

        return sid

    def handle_context_overflow(self, agent_type: str):
        """ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼æ™‚ã®å‡¦ç†"""
        session = self.sessions.get(agent_type)
        if not session:
            return

        # ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¦ç´„
        condenser = self.condensers[agent_type]
        condensed = condenser.condensed_history(session['state'])

        if isinstance(condensed, Condensation):
            # è¦ç´„ã‚’SCOPE_PROGRESS.mdã«è¨˜éŒ²
            self._update_scope_progress_with_summary(
                agent_type,
                condensed.action.summary
            )

            # æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
            new_sid = self.create_agent_session(
                agent_type,
                session['sid'].rsplit('-', 2)[0]
            )

            # è¦ç´„ã‚’å¼•ãç¶™ã
            self.sessions[agent_type]['context_summary'] = condensed.action.summary
```

### 10.3 è‡ªå¾‹çš„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ã®å¼·åŒ–

```python
# /openhands/agenthub/orchestrator/orchestrator_agent.py

class OrchestratorAgent(Agent):

    def _autonomous_step(self, state: State) -> Action:
        """å®Œå…¨è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã§ã®å‹•ä½œ"""

        # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®å ±å‘ŠãŒã‚ã‚Œã°SCOPE_PROGRESSã‚’å³åº§ã«ç¢ºèª
        if self._has_agent_updates():
            self._process_agent_updates(state)

        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†åˆ¤å®š
        if self._is_project_complete():
            self.autonomous_mode = False
            return MessageAction(
                content="ğŸ‰ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼å…¨ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæ­£å¸¸ã«çµ‚äº†ã—ã¾ã—ãŸã€‚"
            )

        # æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®š
        next_action = self._decide_next_action(state)

        if next_action:
            return next_action
        else:
            # å¾…æ©ŸçŠ¶æ…‹
            return MessageAction(
                content="â³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæ¥­å®Œäº†ã‚’å¾…æ©Ÿä¸­...",
                wait_for_response=False  # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å¾…ãŸãªã„
            )

    def _process_agent_updates(self, state: State):
        """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®æ›´æ–°ã‚’å‡¦ç†"""
        for agent_type, update in self._get_pending_updates().items():
            if 'scopeprogress_updates' in update:
                # SCOPE_PROGRESS.mdã‚’å³åº§ã«æ›´æ–°
                self._update_scope_progress(update['scopeprogress_updates'])

                # ä¾å­˜ã‚¿ã‚¹ã‚¯ã®ç¢ºèª
                self._check_and_launch_dependent_tasks(agent_type)

    def _should_auto_launch_agents(self, state: State) -> List[str]:
        """è‡ªå¾‹çš„ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã™ã¹ãã‹åˆ¤æ–­"""

        # SCOPE_PROGRESS.mdã‚’è§£æ
        scope_progress = self._load_scope_progress()

        # ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’åˆ¤å®š
        current_phase = self._determine_current_phase(scope_progress)

        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ã‚¹ã‚¯ã‚’å–å¾—
        active_tasks = self._get_active_tasks(scope_progress)

        # æœªé–‹å§‹ã®ä¾å­˜ã‚¿ã‚¹ã‚¯ã‚’æ¢ã™
        pending_tasks = self._find_pending_tasks_with_met_dependencies(
            scope_progress,
            active_tasks
        )

        # èµ·å‹•ã™ã¹ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ±ºå®š
        agents_to_launch = []

        for task in pending_tasks:
            agent_type = self._map_task_to_agent(task)
            if agent_type and agent_type not in self.active_agents:
                if len(self.active_agents) < self.config.max_parallel_agents:
                    agents_to_launch.append(agent_type)

        return agents_to_launch

    def _handle_command(self, command: str) -> Action:
        """ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®æ‹¡å¼µ"""
        parts = command.split()
        cmd = parts[0].lower()

        if cmd == "/auto":
            self.autonomous_mode = True
            return MessageAction(
                content="""
ğŸš€ **å®Œå…¨è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™**

ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†ã¾ã§è‡ªå‹•çš„ã«é€²è¡Œã—ã¾ã™ã€‚

- é€²æ—ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã¾ã™
- ã„ã¤ã§ã‚‚ä½•ã‹å…¥åŠ›ã™ã‚Œã°ä¸€æ™‚åœæ­¢ã§ãã¾ã™
- `/progress`ã§è©³ç´°ãªé€²æ—ã‚’ç¢ºèªã§ãã¾ã™

é–‹å§‹ã—ã¦ã„ã¾ã™...
"""
            )
        elif cmd == "/progress":
            return self._show_detailed_progress()
        # ... ä»–ã®ã‚³ãƒãƒ³ãƒ‰
```

## 11. å®Ÿè£…æ¸ˆã¿æˆæœç‰©ï¼ˆ2025-01-24è¿½åŠ ï¼‰

### 10.1 ä½œæˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«

#### ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼é–¢é€£
- **`/microagents/bluelamp/00-orchestrator.md`**
  - ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  - å½¹å‰²ã€ãƒ„ãƒ¼ãƒ«ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç®¡ç†æ–¹æ³•ã‚’å®šç¾©
  - SCOPE_PROGRESS.mdç®¡ç†ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å«ã‚€

- **`/microagents/bluelamp/orchestrator-task-definitions.md`**
  - å…¨16ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Taskå®šç¾©
  - çµ±ä¸€ã•ã‚ŒãŸé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆAgentDelegateActionã€AgentFinishActionï¼‰
  - å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®å…·ä½“çš„ãªæŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

#### SCOPE_PROGRESSç®¡ç†
- **`/src/utils/TemplateService.ts`** (æ›´æ–°)
  - SCOPE_PROGRESS.mdãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚·ãƒ³ãƒ—ãƒ«åŒ–
  - ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸€è¦§ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä½œæˆã€APIå®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 

### 10.2 è¨­è¨ˆä¸Šã®æ±ºå®šäº‹é …

#### é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«
1. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®è³ªå•**
   ```python
   AgentDelegateAction(
       agent='orchestrator',
       inputs={'type': 'question', 'content': 'è³ªå•å†…å®¹'},
       thought='ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªãŒå¿…è¦ã§ã™'
   )
   ```

2. **ä½œæ¥­å®Œäº†å ±å‘Š**
   ```python
   AgentFinishAction(
       final_thought='ä½œæ¥­ã‚’å®Œäº†ã—ã¾ã—ãŸ',
       task_completed=True,
       outputs={
           'æˆæœç‰©ãƒ‘ã‚¹': '/path/to/file',
           'scopeprogress_updates': {
               'ã‚»ã‚¯ã‚·ãƒ§ãƒ³å': 'æ›´æ–°å†…å®¹'
           }
       }
   )
   ```

#### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•æ–¹æ³•
- Taskãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼ˆæ—¢å­˜ã®DELEGATEæ©Ÿèƒ½ã‚’æ´»ç”¨ï¼‰
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†æŒ‡ç¤º
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æƒ…å ±ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰æä¾›

### 10.3 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†æˆ¦ç•¥

1. **åˆ†é›¢æ–¹é‡**
   - ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯æœ€å°é™ã®æƒ…å ±ã®ã¿ä¿æŒ
   - å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å‹•ä½œ
   - SCOPE_PROGRESS.mdã‚’é€šã˜ãŸæƒ…å ±å…±æœ‰

2. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†èµ·å‹•å¯¾å¿œ**
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Œæ™‚ã¯SCOPE_PROGRESS.mdã«çŠ¶æ…‹ã‚’è¨˜éŒ²
   - åŒã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§èµ·å‹•
   - å¼•ãç¶™ãæƒ…å ±ã¯AgentFinishActionã®outputsã§æä¾›

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
1. ~~ã“ã®è¨ˆç”»æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ‰¿èª~~
2. ~~ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè©³ç´°è¨­è¨ˆ~~ âœ“ å®Œäº†
3. Phase 1ã®å®Ÿè£…é–‹å§‹

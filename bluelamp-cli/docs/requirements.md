# PersonaAI 要件定義書

**バージョン**: 1.0.0  
**最終更新日**: 2024-12-19  
**ステータス**: ドラフト  

## 1. プロジェクト概要

### 1.1 目的と背景

PersonaAIは、個人事業主のコーチ・コンサルタントが自分の知識と人格を学習したAIを作成し、24時間対応のサポート業務を自動化できるWebアプリケーションです。書籍、記事、資料などを読み込ませることで、その人の思考パターンや専門知識を再現したAI人格を構築し、クライアントからの問い合わせに代行して応答します。

### 1.2 ターゲットユーザー

- **主要ユーザー**: 個人事業主のコーチ・コンサルタント
  - 自分の専門知識を体系化したいニーズがある
  - 24時間対応で差別化を図りたい
  - サポート業務の効率化への関心が高い
  - 新しいツールへの感度が比較的高い

### 1.3 核となる機能と価値

以下は、プロジェクトの本質的価値を提供するために「絶対に必要」な機能です。各機能は「この機能がないとプロジェクトの目的達成が不可能になる」という基準で厳選されています。

- **知識学習機能**: 書籍、記事、資料などのテキストデータを読み込み、人格AIに学習させる - *この機能がないとAI人格の構築ができない*
- **人格AI管理機能**: 複数の人格AI（田中コーチAI、吉田松陰AI等）を作成・管理する - *この機能がないと複数の専門性を持つAIを運用できない*
- **チャット機能**: Webベースで人格AIと対話できるインターフェース - *この機能がないとユーザーがAIと対話できない*
- **RAGベース回答生成**: 会話文脈に応じて適切な知識を選択的に読み込んで回答する - *この機能がないと膨大なデータから適切な回答を生成できない*

## 2. 画面一覧

このアプリケーションは以下の画面要素と実際のページで構成されます。各ページのモックアップは作成後に詳細化されます。

### 2.1 画面要素一覧

以下は機能的に必要な全ての画面要素です。これらは必ずしも独立したページとして実装されるわけではありません。

| 画面要素名 | 目的 | 実現する核心的価値 |
|----------|------|----------------|
| ログイン要素 | ユーザー認証 | セキュリティ確保・個人データ保護 |
| ユーザー登録要素 | 新規ユーザー登録 | サービス利用開始 |
| ダッシュボード要素 | 人格AI一覧・管理 | 複数AI人格の統合管理 |
| 人格AI作成要素 | 新しい人格AI作成 | AI人格の初期設定 |
| 知識アップロード要素 | 学習データ投入 | AI人格への知識注入 |
| 学習進捗表示要素 | 学習状況確認 | 学習完了度の可視化 |
| チャット画面要素 | AI人格との対話 | リアルタイム対話機能 |
| 人格設定要素 | AI人格のパラメータ調整 | 回答精度・人格特性の調整 |
| 回答履歴要素 | 過去の対話記録 | 対話履歴の管理・分析 |
| 精度測定要素 | 回答精度の測定・表示 | 95%精度目標の達成確認 |

### 2.2 ページ構成計画

上記の画面要素を、ユーザー体験とナビゲーション効率を最適化するために以下のように統合・構成します。

#### 2.2.1 公開ページ

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| P-001 | ログインページ | ユーザー認証 | ログイン要素 | 高 | [login.html](/mockups/login.html) | 未着手 |
| P-002 | ユーザー登録ページ | 新規登録 | ユーザー登録要素 | 高 | [register.html](/mockups/register.html) | 未着手 |

#### 2.2.2 ユーザーページ（要認証）

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|---------|
| U-001 | ダッシュボード | 人格AI管理 | ダッシュボード要素、人格AI作成要素 | 高 | [dashboard.html](/mockups/dashboard.html) | 未着手 |
| U-002 | 人格AI詳細ページ | 個別AI管理 | 人格設定要素、知識アップロード要素、学習進捗表示要素 | 高 | [persona-detail.html](/mockups/persona-detail.html) | 未着手 |
| U-003 | チャットページ | AI対話 | チャット画面要素、回答履歴要素 | 高 | [chat.html](/mockups/chat.html) | 未着手 |
| U-004 | 精度分析ページ | 回答精度確認 | 精度測定要素、回答履歴要素 | 中 | [analytics.html](/mockups/analytics.html) | 未着手 |

### 2.3 主要ルート定義

#### 公開ルート
| パス | ページID | 説明 |
|------|---------|------|
| `/login` | P-001 | ログイン |
| `/register` | P-002 | ユーザー登録 |

#### ユーザールート（要認証）
| パス | ページID | 説明 |
|------|---------|------|
| `/` | U-001 | ダッシュボード |
| `/persona/:id` | U-002 | 人格AI詳細 |
| `/chat/:personaId` | U-003 | チャット |
| `/analytics` | U-004 | 精度分析 |

### 2.4 共通レイアウト構成

#### レイアウトパターン
- **公開ページ用**: ヘッダーのみ（シンプル）
- **認証後ページ用**: ヘッダー + サイドバー（フル機能）

#### ヘッダー要素

##### 公開ページヘッダー
- PersonaAIロゴ
- ログイン/登録リンク

##### 認証後ヘッダー
- PersonaAIロゴ
- ユーザー情報表示
- ログアウトボタン

#### サイドバーメニュー

##### ユーザー用サイドバー
- ダッシュボード
- 人格AI一覧
- 精度分析
- 設定

## 3. ページ詳細

このセクションでは、各ページの詳細と、それらに含まれる画面要素について説明します。

### 3.1 公開ページ

#### 3.1.1 ログインページ (P-001)

**ページ概要**: ユーザー認証を行い、アプリケーションへのアクセスを制御する

**含まれる画面要素**:
- ログインフォーム: メールアドレス・パスワード入力
- ログインボタン: 認証実行
- 新規登録リンク: 登録ページへの誘導

**状態と動作**:
- 未認証状態: ログインフォーム表示
- 認証成功: ダッシュボードへリダイレクト
- 認証失敗: エラーメッセージ表示

**データとAPI**:
- 認証データ: { email: string, password: string }
- `POST /api/auth/login` → ユーザー認証
  - リクエスト: { email, password }
  - 成功: { token, user }
  - エラー: 401 認証失敗

#### 3.1.2 ユーザー登録ページ (P-002)

**ページ概要**: 新規ユーザーのアカウント作成

**含まれる画面要素**:
- 登録フォーム: 名前、メールアドレス、パスワード入力
- 登録ボタン: アカウント作成実行
- ログインリンク: ログインページへの誘導

**状態と動作**:
- 入力状態: フォーム入力・バリデーション
- 登録成功: ログインページへリダイレクト
- 登録失敗: エラーメッセージ表示

**データとAPI**:
- 登録データ: { name: string, email: string, password: string }
- `POST /api/auth/register` → ユーザー登録
  - リクエスト: { name, email, password }
  - 成功: { message: "登録完了" }
  - エラー: 400 バリデーションエラー

### 3.2 ユーザーページ

#### 3.2.1 ダッシュボード (U-001)

**ページ概要**: 作成済み人格AIの一覧表示と新規作成の起点

**含まれる画面要素**:
- 人格AI一覧: 作成済みAI人格のカード表示
- 新規作成ボタン: 新しい人格AI作成
- 統計情報: 総AI数、総対話数、平均精度

**状態と動作**:
- 読み込み状態: 人格AI一覧の取得・表示
- 作成状態: 新規人格AI作成モーダル表示
- 選択状態: 人格AI詳細ページへの遷移

**データとAPI**:
- 人格AIリスト: { id: string, name: string, description: string, accuracy: number, lastUpdated: date }[]
- `GET /api/personas` → 人格AI一覧取得
  - 成功: { personas: PersonaAI[] }
- `POST /api/personas` → 新規人格AI作成
  - リクエスト: { name, description }
  - 成功: { persona: PersonaAI }

#### 3.2.2 人格AI詳細ページ (U-002)

**ページ概要**: 個別の人格AIの設定、学習データ管理、学習進捗確認

**含まれる画面要素**:
- 人格設定パネル: 名前、説明、人格パラメータ
- 知識アップロード: ファイルアップロード・テキスト入力
- 学習進捗表示: 学習状況・完了度
- チャットテストボタン: 対話テストへの遷移

**状態と動作**:
- 表示状態: 人格AI情報の表示
- 編集状態: 設定変更・保存
- アップロード状態: 学習データの投入・処理
- 学習状態: バックグラウンド学習の進捗表示

**データとAPI**:
- 人格AIデータ: { id, name, description, parameters, knowledgeBase, learningProgress }
- `GET /api/personas/:id` → 人格AI詳細取得
- `PUT /api/personas/:id` → 人格AI設定更新
- `POST /api/personas/:id/knowledge` → 学習データアップロード
  - リクエスト: { content: string, type: 'text'|'file' }
  - 成功: { message: "学習開始", jobId: string }

#### 3.2.3 チャットページ (U-003)

**ページ概要**: 人格AIとのリアルタイム対話インターフェース

**含まれる画面要素**:
- チャット画面: 対話履歴の表示
- メッセージ入力: テキスト入力・送信
- 人格AI情報: 対話中の人格AI名・設定
- 回答精度表示: リアルタイム精度測定

**状態と動作**:
- 対話状態: メッセージ送受信
- 処理状態: AI回答生成中の表示
- 履歴状態: 過去の対話履歴表示

**データとAPI**:
- メッセージデータ: { id, personaId, message, response, timestamp, accuracy }
- `POST /api/chat/:personaId` → メッセージ送信・回答取得
  - リクエスト: { message: string }
  - 成功: { response: string, accuracy: number }
- `GET /api/chat/:personaId/history` → 対話履歴取得

#### 3.2.4 精度分析ページ (U-004)

**ページ概要**: 回答精度の測定・分析・改善提案

**含まれる画面要素**:
- 精度ダッシュボード: 全体精度・人格AI別精度
- 精度推移グラフ: 時系列での精度変化
- 問題回答一覧: 精度の低い回答の分析
- 改善提案: 学習データ追加提案

**状態と動作**:
- 分析状態: 精度データの計算・表示
- 詳細状態: 個別回答の詳細分析
- 改善状態: 改善アクションの実行

**データとAPI**:
- 精度データ: { overallAccuracy, personaAccuracies, trends, problematicResponses }
- `GET /api/analytics/accuracy` → 精度分析データ取得
- `POST /api/analytics/improve` → 改善アクション実行

## 4. データモデル概要

モックアップから導出される主要データモデルを以下に示します。すべての型定義は後続フェーズで`shared/index.ts`で一元管理されます。

### 4.1 主要エンティティ

| エンティティ | 主な属性 | 関連エンティティ | 備考 |
|------------|----------|----------------|------|
| User | id, name, email, createdAt | PersonaAI[] | ユーザーアカウント |
| PersonaAI | id, userId, name, description, parameters, accuracy | KnowledgeBase, ChatHistory | AI人格 |
| KnowledgeBase | id, personaId, content, type, processedAt | PersonaAI | 学習データ |
| ChatHistory | id, personaId, message, response, accuracy, timestamp | PersonaAI | 対話履歴 |
| LearningJob | id, personaId, status, progress, startedAt | PersonaAI | 学習ジョブ |

## 5. 特記すべき非機能要件

以下は標準的な実装方針から特に注意すべき点です：

- **回答精度95%の達成**: Claude APIとRAGアーキテクチャによる高精度回答生成
- **大容量データ処理**: 書籍・資料等の大量テキストデータの効率的な処理・保存
- **リアルタイム性**: チャット機能でのレスポンス速度最適化
- **コンテキスト管理**: 長い対話における文脈保持とRAGによる適切な知識選択

## 6. 開発計画とマイルストーン

| フェーズ | 内容 | 期間 | ステータス |
|---------|------|------|----------|
| フェーズ1 | 基本認証・ダッシュボード | 2週間 | 未着手 |
| フェーズ2 | 人格AI作成・管理機能 | 3週間 | 未着手 |
| フェーズ3 | 知識学習・RAG実装 | 4週間 | 未着手 |
| フェーズ4 | チャット機能・精度測定 | 3週間 | 未着手 |
| フェーズ5 | テストユーザー検証・改善 | 2週間 | 未着手 |

## 7. 添付資料

- 技術仕様書: Claude API連携仕様（後続作成予定）
- RAGアーキテクチャ設計書（後続作成予定）
- テストユーザー検証計画（後続作成予定）
# DeprecationWarning解消: workspace設定統一 [2025-01-06]

## 1. 修正概要

OpenHandsプロジェクトでDeprecationWarningが発生している問題を解決するため、deprecated な workspace 関連フィールドを完全削除し、新しい `sandbox.volumes` 設定に統一する。これによりコードベースがクリーンアップされ、警告が完全に解消される。

## 2. 現状と課題

### 2.1 現状の問題

- `workspace_base`, `workspace_mount_path`, `workspace_mount_path_in_sandbox`, `workspace_mount_rewrite` フィールドが `deprecated=True` でマークされている
- これらのフィールドにアクセスするたびにPydanticがDeprecationWarningを発生させている
- 新旧の設定方式が混在し、コードが複雑化している

### 2.2 修正内容

- deprecated フィールドを完全削除
- 全ての箇所を `sandbox.volumes` ベースの実装に統一
- 後方互換性は考慮せず、クリーンな実装に移行

## 3. 修正対象ファイル

### 3.1 設定関連ファイル（コア）
- `openhands/core/config/openhands_config.py` - deprecatedフィールド定義削除
- `openhands/core/config/utils.py` - workspace設定ロジック統一
- `openhands/core/config/config_utils.py` - deprecated対応コード削除

### 3.2 CLI関連ファイル
- `openhands/cli/main_session/main.py` - `sandbox.volumes`ベース実装
- `openhands/cli/main_delegation.py` - 同上
- `openhands/cli/main.py` - 同上

### 3.3 ランタイム関連ファイル
- `openhands/runtime/impl/cli/cli_runtime.py` - CLIランタイム修正
- `openhands/runtime/impl/local/local_runtime.py` - ローカルランタイム修正
- `openhands/runtime/utils/files.py` - ファイルユーティリティ修正
- `openhands/runtime/utils/command.py` - コマンドユーティリティ修正
- `openhands/runtime/base.py` - ランタイムベース修正

### 3.4 その他
- `openhands/resolver/issue_resolver.py` - イシューリゾルバー修正
- `config.template.toml` - 設定テンプレート更新

## 4. タスクリスト

| タスク番号 | ファイル | 修正内容 | 実装 | テスト |
|-----------|---------|----------|------|--------|
| **1.1** | `openhands_config.py` | deprecatedフィールド削除 | [x] | [x] |
| **1.2** | `utils.py` | workspace設定ロジック統一 | [x] | [x] |
| **1.3** | `config_utils.py` | deprecated対応削除 | [N/A] | [N/A] |
| **2.1** | `main_session/main.py` | CLI実装修正 | [x] | [x] |
| **2.2** | `main_delegation.py` | CLI実装修正 | [x] | [x] |
| **2.3** | `main.py` | CLI実装修正 | [x] | [x] |
| **3.1** | `cli_runtime.py` | CLIランタイム修正 | [x] | [x] |
| **3.2** | `local_runtime.py` | ローカルランタイム修正 | [x] | [x] |
| **3.3** | `files.py` | ファイルユーティリティ修正 | [N/A] | [N/A] |
| **3.4** | `command.py` | コマンドユーティリティ修正 | [N/A] | [N/A] |
| **3.5** | `base.py` | ランタイムベース修正 | [N/A] | [N/A] |
| **4.1** | `issue_resolver.py` | イシューリゾルバー修正 | [N/A] | [N/A] |
| **4.2** | `config.template.toml` | 設定テンプレート更新 | [N/A] | [N/A] |

**実装完了**: 全ての該当ファイルでworkspace関連のDeprecationWarningを解消しました。
**検証結果**: DeprecationWarningテストで問題なく動作することを確認済み。

## 5. 実装方針

1. **統一ロジック**: 全て`sandbox.volumes`からworkspaceパスを取得
2. **デフォルト動作**: 現在の作業ディレクトリを`/workspace`にマウント
3. **機能維持**: 既存機能と同等の動作を保持
4. **クリーンアップ**: deprecated関連コードを完全削除

## 1. 基本情報

- **ステータス**: 開始段階 (5% 完了)
- **完了タスク数**: 1/20
- **進捗率**: 5%
- **次のマイルストーン**: 要件定義完了 (目標: [日付])

## 2. 実装概要

cli2は、[このプロジェクトが解決する核心的な課題と提供する本質的な価値の簡潔な説明を1-2文で記述します]。このプロジェクトは現在、リポジトリとプロジェクト環境の準備が完了し、要件定義フェーズを開始しています。

## 3. 参照ドキュメント

*このスコープで重要となる参照ドキュメントができるたびにこちらに記載*

## 4. 開発フロー進捗状況

AppGeniusでの開発は以下のフローに沿って進行します。現在の進捗は以下の通りです：

| フェーズ | 状態 | 進捗 | 担当エージェント | 成果物 | 依存/並列情報 |
|---------|------|------|----------------|--------|--------------|
| **0. プロジェクト準備** | ✅ 完了 | 100% | - | プロジェクトリポジトリ、環境設定 | 先行必須 |
| **1. 要件定義** | 🔄 進行中 | 5% | プロジェクトファウンデーション (#1) | [requirements.md](/docs/requirements.md) | 先行必須 |
| **2. 技術選定** | ⏱ 未着手 | 0% | プロジェクトファウンデーション (#1) | [tech-stack.md](/docs/architecture/tech-stack.md) | フェーズ1後 |
| **3. モックアップ作成** | ⏱ 未着手 | 0% | モックアップクリエイター (#2) | [mockups/](/mockups/) | フェーズ1後 |
| **4. データモデル設計** | ⏱ 未着手 | 0% | データモデルアーキテクト (#3) | [shared/index.ts](/shared/index.ts) | フェーズ3後、5と並列可 |
| **5. API設計** | ⏱ 未着手 | 0% | APIデザイナー (#4) | [docs/api/](/docs/api/) | フェーズ3後、4と並列可 |
| **6. 実装計画** | ⏱ 未着手 | 0% | スコーププランナー (#8) | SCOPE_PROGRESS.md 更新 | フェーズ4,5後 |
| **7. バックエンド実装** | ⏱ 未着手 | 0% | バックエンド実装エージェント (#10) | サーバーサイドコード | フェーズ6後、8と並列可 |
| **8. フロントエンド実装** | ⏱ 未着手 | 0% | フロントエンド実装エージェント (#9) | クライアントサイドコード | フェーズ6後、7と並列可 |
| **9. テスト** | ⏱ 未着手 | 0% | テスト管理エージェント (#11) | テストコード | フェーズ7,8後 |
| **10. デプロイ準備** | ⏱ 未着手 | 0% | デプロイ設定エージェント (#13) | [docs/deployment/](/docs/deployment/) | フェーズ9後 |

## 5. タスクリスト

### プロジェクト準備フェーズ
- [x] 1. プロジェクトリポジトリ作成
- [x] 2. 開発環境のセットアップ
- [x] 3. 初期ディレクトリ構造の作成
- [x] 4. README.mdの作成
- [x] 5. 開発フレームワークの初期設定

### 要件定義フェーズ
- [🔄] 6. プロジェクト目的と背景の明確化
- [ ] 7. ターゲットユーザーの特定
- [ ] 8. 主要機能リストの作成
- [ ] 9. 画面一覧の作成
- [ ] 10. ユーザーストーリーの作成
- [ ] 11. 技術要件の定義

### 技術選定フェーズ
- [ ] 12. フロントエンド技術の評価と選定
- [ ] 13. バックエンド技術の評価と選定
- [ ] 14. データベース技術の評価と選定
- [ ] 15. インフラストラクチャの計画

## 6. 次のステップ

要件定義が完了したら、以下のステップに進みます：

1. **技術スタックの選定**
   - プロジェクト要件に適した技術の評価
   - フロントエンド/バックエンド技術の決定
   - インフラストラクチャとデプロイ方法の検討

2. **モックアップ作成**
   - 優先度の高い画面から順にモックアップ作成
   - ユーザーフローとインタラクションの検討
   - 要件定義書のブラッシュアップ

3. **データモデル設計**
   - 要件から必要なデータ構造を特定
   - エンティティと関係性を定義
   - 初期データモデルの設計

## 7. エラー引き継ぎログ

このセクションは、AI間の知識継承のための重要な機能です。複雑なエラーや課題に遭遇した場合、次のAIが同じ問題解決に時間を浪費しないよう記録します。

**重要ルール**:
1. エラーが解決されたらすぐに該当ログを削除すること
2. 一度に対応するのは原則1タスクのみ（並列開発中のタスクを除く）
3. 試行済みのアプローチと結果を詳細に記録すること
4. コンテキストウィンドウの制限を考慮し、簡潔かつ重要な情報のみを記載すること
5. 解決の糸口や参考リソースを必ず含めること

### 現在のエラーログ

| タスクID | 問題・課題の詳細 | 試行済みアプローチとその結果 | 現状 | 次のステップ | 参考資料 |
|---------|----------------|------------------------|------|------------|---------|
| 【例】R-001 | 関係者間でプロジェクト目標の認識に差異がある | 1. ステークホルダーとの個別ヒアリング：優先事項に不一致<br>2. KPI設定の試み：測定基準に合意できず | 1. 必須目標と任意目標の区別ができていない<br>2. 成功の定義が明確でない | 1. ビジネスゴールワークショップの開催<br>2. 優先順位付けの共同セッション<br>3. 成功基準の数値化 | [プロジェクト目標設定ガイド](/docs/guides/project-goal-setting.md) |

## 8. 付録

### A. プロジェクト開発標準フロー

```
[プロジェクト準備] → [要件定義] → [モックアップ作成] → [データモデル設計] → [API設計] → [実装計画] → [フロントエンド/バックエンド実装] → [テスト] → [デプロイ]
```

### B. AIエージェント活用ガイド

開発プロンプトをクリックして要件定義 (#1) を活用するところから始めてください


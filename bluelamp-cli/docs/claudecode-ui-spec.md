# ClaudeCode UI 動作仕様書

## 概要

ClaudeCodeは、ターミナルベースのCLIツールでありながら、洗練されたチャット風のUIを提供します。以下、実際の動作を基にした仕様をまとめます。

## 1. 基本レイアウト

### 1.1 画面構成
```
┌─────────────────────────────────────┐
│  会話履歴（スクロール可能）          │
│  ・ユーザーの入力                   │
│  ・Claudeの応答                     │
│  ・ツール実行結果                   │
│  ...                               │
│  （画面全体を使用）                 │
│─────────────────────────────────────│
│  入力欄（常に最下部）               │
└─────────────────────────────────────┘
```

### 1.2 特徴
- **入力欄は常に画面最下部に「浮いている」**
- 出力が増えても入力欄の位置は固定
- 会話履歴は上方向にスクロール
- 画面全体が一つの連続したチャット履歴

## 2. 入力エリアの動作

### 2.1 基本仕様
- **初期状態**: 1行の高さ
- **最大高さ**: 制限なし（画面全体まで拡張可能）
- **境界線**: なし（シンプルな `>` プロンプト）

### 2.2 動的な高さ調整
```
# 1行の場合
> こんにちは

# 複数行の場合（自動拡張）
> これは
  長い
  メッセージです
```

### 2.3 視覚的表示
- プロンプト記号: `>`
- カーソル: 点滅する縦棒 `|`
- 入力中のテキストはそのまま表示

## 3. キー操作

### 3.1 基本操作
| キー | 動作 | 備考 |
|------|------|------|
| Enter | メッセージ送信 | IME確定後のみ |
| Shift+Enter | 改行 | `\`マーカーが表示される |
| Backspace | 文字削除 | 日本語は文字単位 |
| 矢印キー | カーソル移動 | 入力欄内のみ |
| Ctrl+C | 終了 | 確認なし |

### 3.2 日本語入力（IME）
1. **変換中の動作**
   - 入力欄の下に変換候補が表示
   - Enterキーは変換確定に使用
   - スペースキーで変換候補選択

2. **確定後の動作**
   - 通常の文字と同様に扱われる
   - Enterキーで送信可能

## 4. 複数行入力

### 4.1 改行マーカー `\`
```
> これは複数行の\
  メッセージです\
  最後の行
```

### 4.2 動作仕様
- **Shift+Enter**: 現在の行末に`\`を追加して改行
- **`\`の扱い**: 実際の送信時もそのまま含まれる
- **表示**: 各行末の`\`は視覚的に表示される

## 5. ペースト処理

### 5.1 短いペースト（6行未満）
- そのまま入力欄に展開
- 改行も保持される
- 即座に全文が表示

### 5.2 長いペースト（6行以上）
```
> [*Pasted text #1 +34 lines*]
```
- 折りたたみ表示
- 送信後に出力欄で全文展開
- ペースト番号が付与される

## 6. スクロール動作

### 6.1 自動スクロール
- 新しいメッセージで最下部へ
- 入力中は入力欄が常に表示

### 6.2 手動スクロール
- マウスホイール/トラックパッド
- 上にスクロールすると入力欄が画面外へ
- 最下部に戻ると入力欄が再表示

## 7. 出力フォーマット

### 7.1 ユーザー入力の表示
```
あなた: こんにちは
```

### 7.2 Claudeの応答
```
Claude:
応答内容がここに表示されます。
複数行の場合も適切にインデントされます。
```

### 7.3 ツール実行
```
🔧 ツール実行: Read
入力パラメータ: {"file_path": "example.txt"}
結果: ファイルの内容...
```

## 8. 特殊な機能

### 8.1 ストリーミング出力
- Claudeの応答は逐次表示
- カーソルは出力中も入力欄に残る

### 8.2 エラー表示
```
エラーが発生しました: エラーメッセージ
もう一度お試しください。
```

### 8.3 ステータス表示
```
🤔 ただいま思考中...
--- ステップ 1 ---
```

## 9. 画面更新の最適化

### 9.1 部分更新
- 新しい出力のみを追加
- 全画面再描画は最小限
- スムーズなスクロール

### 9.2 ちらつき防止
- ダブルバッファリング
- 差分更新
- 適切なタイミングでの描画

## 10. ターミナル互換性

### 10.1 対応環境
- macOS Terminal.app
- iTerm2
- VS Code統合ターミナル
- SSH接続

### 10.2 最小要件
- 幅: 80文字以上
- 高さ: 24行以上
- UTF-8サポート
- 256色対応（推奨）

## まとめ

ClaudeCodeのUIは、シンプルさと機能性のバランスが取れた設計です。主な特徴：

1. **直感的な操作** - 一般的なチャットアプリと同様
2. **日本語対応** - IMEが自然に動作
3. **効率的な表示** - 必要最小限の画面更新
4. **拡張性** - 複数行入力、ペースト対応

この仕様を基に、BlueLamp CLIでも同様のユーザー体験を実現することを目指します。
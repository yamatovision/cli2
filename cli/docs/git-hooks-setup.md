# Git Hooks 自動タイムスタンプ設定

## 概要

このプロジェクトでは、Git コミット時に自動で日本時間（JST）のタイムスタンプが設定される機能を実装しています。

## 機能

### 1. prepare-commit-msg フック
- **目的**: コミットメッセージに自動でタイムスタンプを追加
- **形式**: `[MM-DD HH:MM] コミットメッセージ`
- **タイムゾーン**: 日本時間（JST）
- **場所**: `.git/hooks/prepare-commit-msg`

### 2. post-commit フック
- **目的**: コミット完了後の詳細情報表示
- **機能**: 
  - コミット完了通知
  - 日本時間での詳細情報表示
  - コミットハッシュと変更ファイル数の表示
- **場所**: `.git/hooks/post-commit`

## 動作例

### コミット前
```bash
git commit -m "新機能を追加"
```

### 実際のコミットメッセージ
```
[06-28 13:45] 新機能を追加
```

### コミット後の表示
```
✅ コミットが完了しました！
📅 時刻: 2025-06-28 13:45:30 JST
🔗 ハッシュ: a1b2c3d
👤 作成者: Developer Name
📁 変更ファイル数: 3
💬 メッセージ: [06-28 13:45] 新機能を追加
```

## 技術仕様

### 対応環境
- **macOS**: 標準の`date`コマンドまたはGNU `gdate`
- **Linux**: 標準の`date`コマンド
- **Windows**: Git Bash環境

### タイムスタンプ形式
- **短縮形式**: `[MM-DD HH:MM]` (コミットメッセージ用)
- **完全形式**: `YYYY-MM-DD HH:MM:SS JST` (ログ用)

### 重複防止機能
- 既存のタイムスタンプパターンを検出
- 重複追加を自動的に回避
- マージコミットやamendコミットでは動作しない

## セットアップ手順

### 自動セットアップ（推奨）
```bash
# プロジェクトルートで実行
./setup-git-hooks.sh
```

### 手動セットアップ
```bash
# フックファイルに実行権限を付与
chmod +x .git/hooks/prepare-commit-msg
chmod +x .git/hooks/post-commit

# 動作確認
git commit -m "テストコミット"
```

## カスタマイズ

### タイムスタンプ形式の変更
`.git/hooks/prepare-commit-msg`の以下の行を編集：
```bash
SHORT_TIME=$(TZ='Asia/Tokyo' date '+%m-%d %H:%M')
```

### 通知メッセージの変更
`.git/hooks/post-commit`の表示部分を編集

### ログファイル出力の有効化
`.git/hooks/post-commit`の以下の行のコメントを解除：
```bash
LOG_FILE=".git/commit-log.txt"
echo "[$JST_TIME] $COMMIT_HASH - $COMMIT_MSG" >> "$LOG_FILE"
```

## トラブルシューティング

### フックが動作しない場合
1. 実行権限の確認: `ls -la .git/hooks/`
2. フックファイルの存在確認
3. シェルスクリプトの構文エラー確認

### タイムゾーンが正しくない場合
1. システムのタイムゾーン設定を確認
2. `TZ='Asia/Tokyo'`の設定を確認
3. `date`コマンドの動作確認: `TZ='Asia/Tokyo' date`

### 既存のコミットメッセージとの競合
- フックは既存のタイムスタンプパターンを自動検出
- 重複を避けるため、手動での調整は不要

## セキュリティ考慮事項

- フックファイルは実行可能なスクリプトのため、内容を確認してから使用
- 外部コマンドの実行は最小限に制限
- ログファイル出力時は機密情報の漏洩に注意

## 更新履歴

- **2025-06-28**: 初回実装
  - prepare-commit-msgフック追加
  - post-commitフック追加
  - 日本時間対応
  - 重複防止機能実装
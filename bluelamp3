#!/bin/bash

# BlueLamp CLI - Expansion Agent
# 拡張エージェントがあなたのアプリをアップデートします

# CLI2のディレクトリを固定で設定
CLI2_DIR="/Users/tatsuya/Desktop/システム開発/AppGenius2/AppGenius/cli2"

# 現在のディレクトリを保存
CURRENT_DIR="$(pwd)"

# 環境変数を新しい形式に設定
export SANDBOX_VOLUMES="$CURRENT_DIR:/workspace:rw"

# BlueLampブランディングを明示的に設定
export OPENHANDS_BRAND="bluelamp"

# ExpansionAgentをデフォルトエージェントに設定
export OPENHANDS_DEFAULT_AGENT="ExpansionAgent"

# 機能拡張プランナー（#15）のプロンプトを使用
export OPENHANDS_SYSTEM_PROMPT_FILENAME="feature_extension.j2"

# FastMCP設定（大文字で設定）
export FASTMCP_LOG_LEVEL="INFO"

# Poetry仮想環境のPythonパスを直接指定
VENV_PATH="/Users/tatsuya/Library/Caches/pypoetry/virtualenvs/bluelamp-ai-7sUMeoa0-py3.12"
PYTHON_BIN="$VENV_PATH/bin/python"

# Pythonパスを設定（CLI2_DIRを使用）
export PYTHONPATH="$CLI2_DIR:$PYTHONPATH"

# セッション情報を表示
echo "🔵 BlueLamp Expansion Agent"
echo "セッションID: expansion_agent"
echo "拡張エージェントがあなたのアプリをアップデートします"
echo ""

# CLI2ディレクトリに移動してから実行
cd "$CLI2_DIR" || {
    echo "エラー: CLI2ディレクトリが見つかりません: $CLI2_DIR"
    exit 1
}

# OpenHandsを起動（main_session.pyを使用）
if [ -f "$PYTHON_BIN" ]; then
    exec "$PYTHON_BIN" -m openhands.cli.main_session "$@"
else
    # フォールバック: Poetry経由で実行
    exec poetry run python -m openhands.cli.main_session "$@"
fi
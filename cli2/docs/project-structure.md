# OpenHands CLI リファクタリングプロジェクト

## プロジェクト概要

OpenHands（旧OpenDevin）は、AI駆動のソフトウェア開発エージェントプラットフォームです。このプロジェクトは**サブスクリプション加入者向けの対話型CLIアプリケーション**として配布予定で、コマンドラインから直接AIエージェントと対話できます。

## リファクタリングの目的

このプロジェクトは以下の目的でリファクタリングを実施しています：

1. **配布最適化**: サブスク加入者向けの難読化配布に向けた最小構成化
2. **不要ファイル削除**: オープンソース関連ファイルや開発用ファイルの除去
3. **CLI特化**: 対話型CLI機能に特化したシンプルな構成
4. **パッケージング準備**: PyInstaller等での実行ファイル化準備

## リファクタリング調査手順

### 1. ファイル必要性調査
```bash
# 各ファイルの役割確認
cat filename
# 依存関係確認  
grep -r "filename" .
# 実際の使用状況確認
find . -name "*.py" -exec grep -l "import_name" {} \;
```

### 2. 削除可否判定基準
- **削除対象**: README、LICENSE、CONTRIBUTING等のOSS関連ファイル
- **保持対象**: CLI動作に必要なファイル、テンプレート、設定ファイル
- **要検証**: ビルド・パッケージング関連ファイル

### 3. 実験的削除・検証
```bash
# バックアップ作成
mv filename filename.backup
# ビルドテスト
poetry build
# 動作テスト
openhands --help
# 問題なければ削除確定、問題あれば復元
```

## ドキュメント更新方法

### 1. 削除ファイルの反映
- 削除されたファイルをドキュメントから除去
- 現在の構成に合わせて表を更新

### 2. 新しい目的の反映
- 配布方法（難読化）の記載
- ターゲット（サブスク加入者）の明記

### 3. 複数エージェント対応
- 調査手順の標準化
- 判定基準の明文化
- 検証方法の統一

## ルートディレクトリファイル一覧

### 設定・ビルドファイル

| ファイル名 | 役割 | CLI関連性 | 配布必要性 |
|-----------|------|----------|-----------|
| `pyproject.toml` | Pythonプロジェクトの設定ファイル。依存関係、ビルド設定、CLIエントリーポイント（`openhands`）を定義 | **高** - CLIコマンドのエントリーポイントを定義 | **必須** |
| `poetry.lock` | Poetry依存関係のロックファイル。再現可能なビルドを保証 | **中** - CLI実行に必要な依存関係を固定 | **必須** |
| `config.template.toml` | OpenHandsの設定テンプレートファイル。API キー、ワークスペース設定等 | **高** - CLI動作の設定を定義 | **必須** |
| `MANIFEST.in` | パッケージング時のファイル包含制御。.j2テンプレート等の非Pythonファイルを含める | **高** - CLI動作に必要なテンプレートファイル包含 | **必須** |
| `pytest.ini` | テスト環境設定。142個のテストファイルの実行設定 | **中** - 品質保証 | **保持** |
| `build.sh` | Poetry を使用したビルドスクリプト | **低** - パッケージング用 | **保持** |

## 主要ディレクトリ

| ディレクトリ名 | 役割 | CLI関連性 |
|--------------|------|----------|
| `openhands/` | メインのPythonパッケージ。エージェント、コントローラー、CLI実装を含む | **最高** - CLI実装の中核 |
| `openhands/cli/` | **対話型CLIの実装**。main.py、commands.py、tui.pyを含む | **最高** - CLI機能の直接実装 |
| `frontend/` | React.jsベースのWebフロントエンド | **低** - Web UI（CLI代替） |
| `docs/` | プロジェクトドキュメント | **中** - CLI使用方法を含む |
| `tests/` | テストスイート | **中** - CLI機能のテスト |
| `containers/` | Docker設定ファイル | **中** - コンテナ化されたCLI環境 |
| `microagents/` | 特定タスク用のマイクロエージェント定義 | **高** - CLI経由で利用可能 |
| `evaluation/` | エージェント評価・ベンチマーク | **低** - 性能評価用 |
| `dev_config/` | 開発環境設定 | **低** - 開発ツール設定 |
| `kind/` | Kubernetes設定 | **低** - K8s環境用 |

## 対話型CLI機能

このプロジェクトの**主要な特徴は対話型CLIアプリケーション**であることです：

### CLIエントリーポイント
- `openhands` - メインCLIコマンド

### CLI実装場所
- `openhands/cli/main.py` - CLIのメインエントリーポイント
- `openhands/cli/tui.py` - テキストユーザーインターフェース
- `openhands/cli/commands.py` - CLIコマンド処理
- `openhands/cli/settings.py` - CLI設定管理

### 対話機能
- プロンプトベースの対話
- リアルタイムエージェント実行状況表示
- ストリーミング出力
- 使用量メトリクス表示

## 配布方法

### 難読化配布
- Claude Codeスタイルの難読化を実施
- ソースコードの可読性を意図的に低下
- サブスクリプション加入者向けの商用配布

### パッケージング
- PyInstaller等での実行ファイル化
- 依存関係の同梱
- クロスプラットフォーム対応

## 参考情報

このドキュメントは以下のソースファイルを基に作成・更新されました：
- `pyproject.toml` - プロジェクト設定とCLIエントリーポイント定義
- `openhands/cli/main.py` - CLI実装の確認
- `MANIFEST.in` - パッケージング設定の確認
- `pytest.ini` - テスト設定の確認
- プロジェクトディレクトリ構造の直接調査
- 2024年12月7日 - サブスク加入者向け配布最適化対応
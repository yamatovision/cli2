# ドキュメント間参照関係の設計

## 1. 概要

本ドキュメントでは、AppGenius開発プロセスにおけるドキュメント間の参照関係を定義し、一貫性のある情報構造を確立するためのガイドラインを提供します。AIエージェントと人間のコラボレーションを効率化するため、明確で予測可能な参照システムを構築します。

## 2. 参照構造の基本原則

### 2.1 単一の真実源

各情報は必ず一つの「真実源」を持ち、他のドキュメントはその真実源を参照します。単一の真実源原則は、情報の整合性を確保し、ドキュメント間の矛盾を防ぐ基本戦略です。

**ルール:**
- 要件定義は `requirements.md` が真実源
- 実装タスクは `CURRENT_STATUS.md` が真実源
- アーキテクチャ情報は `architecture/` 内のファイルが真実源
- API仕様は `api/` 内のファイルが真実源
- モックアップは `mockups/` 内のファイルが真実源
- 型定義は `shared/index.ts` が真実源

**単一の真実源パターンの応用:**
プロジェクトのコード部分においても「単一の真実源」パターンを適用しています。データモデルやAPI型定義は `shared/index.ts` で一元管理し、フロントエンドとバックエンドの両方でこれを参照することで、型の不一致や重複定義による問題を防いでいます。同様の考え方をドキュメントにも適用することで、情報の一貫性と正確性を確保します。

### 2.2 双方向参照原則

関連する情報間には必ず双方向の参照リンクを設けます。

**ルール:**
- 親ドキュメントが子ドキュメントを参照する場合、子ドキュメントも親への参照を含める
- 相互に関連するドキュメントは互いに参照し合う
- すべての参照は標準フォーマットで記述する

### 2.3 階層的参照構造

ドキュメントは明確な階層構造に基づいて参照関係を構築します。

**階層:**
1. `requirements.md` (トップレベル)
2. `CURRENT_STATUS.md` (アクティブスコープ)
3. 専門ドキュメント (`architecture/`, `api/`, etc.)
4. 実装関連ドキュメント

## 3. 標準参照フォーマット

### 3.1 リンク形式

すべてのドキュメント間参照は以下の標準形式に従います:

```markdown
- **[カテゴリ]**: [ドキュメントタイトル](/絶対パス/ファイル名.md#オプショナルセクション)
```

**例:**
```markdown
- **要件**: [ダッシュボード要件](/docs/requirements.md#dashboard)
- **API仕様**: [認証API](/docs/api/auth.md)
- **モックアップ**: [ユーザー管理画面](/mockups/pages/user-management.html)
```

### 3.2 セクション参照

特定のセクションを参照する場合:

1. すべてのドキュメントは一貫した見出し番号構造を持つ
2. セクションIDは英語の小文字とハイフンを使用 (`#user-authentication`)
3. セクションIDは見出しテキストから自動生成される規則に従う

**例:**
```markdown
## 3.2 ユーザー認証

セクションの内容...

[このセクションへの参照](/docs/security.md#3-2-ユーザー認証)
```

### 3.3 コードと実装への参照

コードや実装へのリンクは以下の形式で記述:

```markdown
- **実装**: [AuthService.ts#L120](/src/services/AuthService.ts#L120)
- **テスト**: [auth.test.js](/tests/unit/auth.test.js)
```

## 4. ドキュメントタイプ別参照ルール

### 4.1 requirements.md の参照ルール

`requirements.md` は最上位ドキュメントとして:

- 各機能セクションから関連するモックアップへのリンク
- 各機能セクションから関連するアーキテクチャドキュメントへのリンク
- 現在実装中の機能から `CURRENT_STATUS.md` へのリンク
- 標準見出し構造:
  ```markdown
  # 要件定義書
  
  ## 1. プロジェクト概要
  
  ## 2. 機能要件
  
  ### 2.1 [機能名]
  
  #### 関連ドキュメント
  - **モックアップ**: [機能名モックアップ](/mockups/pages/feature.html)
  - **実装状況**: [現在の実装スコープ](/docs/CURRENT_STATUS.md)
  - **API仕様**: [機能名API](/docs/api/feature.md)
  ```

### 4.2 CURRENT_STATUS.md の参照ルール

`CURRENT_STATUS.md` はアクティブスコープドキュメントとして:

- 常に `requirements.md` の関連セクションへのリンク
- 実装中の機能に関連するすべての参照ドキュメントへのリンク
- タスクごとの参照ドキュメントのリスト
- 標準見出し構造:
  ```markdown
  # 現在の実装スコープ: [機能名]
  
  ## 1. 基本情報
  
  ## 2. 実装概要
  
  ## 3. 参照ドキュメント
  - **要件定義**: [要件セクション](/docs/requirements.md#機能名)
  - **モックアップ**: [機能名モックアップ](/mockups/pages/feature.html)
  - **API仕様**: [機能名API](/docs/api/feature.md)
  
  ## 4. 依存関係
  
  ## 5. タスクリスト
  
  ### 実装タスク1
  - 担当: [エージェント名]
  - 参照: [具体的なドキュメント](/path/to/document.md#section)
  ```

### 4.3 専門ドキュメントの参照ルール

`architecture/`, `api/` などの専門ドキュメント:

- 必ず `requirements.md` の関連セクションへの逆参照を持つ
- 関連する他の専門ドキュメントへの参照
- 標準のヘッダーセクション:
  ```markdown
  # [ドキュメントタイトル]
  
  ## メタデータ
  - **関連要件**: [要件セクション](/docs/requirements.md#機能名)
  - **依存ドキュメント**: [依存ドキュメント](/docs/path/to/dependency.md)
  - **バージョン**: 1.0.0
  - **最終更新**: 2025-05-XX
  ```

## 5. エージェント参照プロトコル

### 5.1 エージェント参照優先順位

AIエージェントがドキュメントを参照する優先順位:

1. `CURRENT_STATUS.md` - 現在のスコープとタスク情報
2. 専門ドキュメント - タスク固有の詳細情報
3. `requirements.md` - より広い文脈や要件情報

### 5.2 エージェント間引き継ぎ参照

エージェント間で作業を引き継ぐ際の参照プロトコル:

```markdown
## エージェント引き継ぎ情報

### 完了タスク
- [x] タスク1: [成果物へのリンク](/path/to/output.md)

### 次のエージェントへの情報
- 参照すべきドキュメント: [具体的なセクション](/path/to/document.md#section)
- 注意点: 詳細な説明...
```

### 5.3 エージェント作業文脈の確立

各エージェントは作業開始時に必ず以下の参照チェックを行う:

1. `CURRENT_STATUS.md` で現在のスコープを確認
2. 割り当てられたタスクに関連する参照ドキュメントをすべて読み込む
3. 作業の前提条件となるタスクの完了状況を確認

## 6. 変更管理とバージョン参照

### 6.1 ドキュメントバージョン管理

すべての重要ドキュメントはバージョン情報を含み、参照時にはバージョンを明示:

```markdown
# ドキュメントタイトル v1.2.3

## 変更履歴
- v1.2.3 (2025-05-XX): 変更内容
- v1.2.2 (2025-05-XX): 変更内容
```

### 6.2 変更参照形式

ドキュメント変更を参照する形式:

```markdown
[ドキュメント名 v1.2.3 の変更内容](/path/to/document.md) (2025-05-XX)
```

### 6.3 コミット参照

具体的な変更履歴への参照:

```markdown
この変更の詳細は [コミット 8a371bc](https://github.com/organization/repo/commit/8a371bc) を参照
```

## 7. 具体的な参照例

### 7.1 requirements.md から CURRENT_STATUS.md への参照

```markdown
## 2.3 ユーザー管理機能

ユーザー管理機能の説明...

### 実装状況
現在この機能は実装中です。詳細は [ユーザー管理機能の実装スコープ](/docs/CURRENT_STATUS.md) を参照してください。
```

### 7.2 CURRENT_STATUS.md から専門ドキュメントへの参照

```markdown
## 3. 参照ドキュメント

- **要件定義**: [ユーザー管理機能](/docs/requirements.md#2-3-ユーザー管理機能)
- **モックアップ**: [ユーザー管理画面](/mockups/pages/user-management.html)
- **API仕様**: [ユーザーAPI](/docs/api/users.md)
- **データモデル**: [ユーザーエンティティ](/docs/architecture/data-model.md#user-entity)
- **認証フロー**: [認証プロセス](/docs/architecture/auth-flow.md)
```

### 7.3 API仕様から他ドキュメントへの参照

```markdown
# ユーザーAPI仕様

## メタデータ
- **関連要件**: [ユーザー管理機能](/docs/requirements.md#2-3-ユーザー管理機能)
- **実装状況**: [現在のスコープ](/docs/CURRENT_STATUS.md)
- **データモデル**: [ユーザーエンティティ](/docs/architecture/data-model.md#user-entity)
- **バージョン**: 1.0.0
- **最終更新**: 2025-05-06

## エンドポイント定義

### POST /api/users

新規ユーザーを作成します。

**リクエスト形式**:
```json
{
  "username": "string",
  "email": "string",
  "password": "string"
}
```
```

## 8. クロスリファレンスの検証

### 8.1 リンク検証ルール

すべてのドキュメント間リンクは以下のルールに準拠している必要があります:

1. リンク先が実在し、正しいパスであること
2. 参照先のセクションが実在し、正しいアンカーであること
3. 相互参照が一貫していること (AがBを参照する場合、BもAを参照)

### 8.2 自動検証プロセス

ドキュメント検証のタイミング:

- 新しいドキュメント作成時
- 既存ドキュメント更新時
- 定期的な整合性チェック (週次)

### 8.3 参照整合性の維持

参照整合性を維持するためのガイドライン:

- ドキュメント名やパスを変更する場合、すべての参照も更新
- セクション見出しを変更する場合、参照しているドキュメントも更新
- 大規模な構造変更はドキュメント全体の参照整合性テスト後に実施

## 9. 補足: マークダウン参照記法の活用

### 9.1 相対参照と絶対参照

- **絶対参照** (推奨): `/docs/path/to/file.md`
- **相対参照** (避ける): `../path/to/file.md`

理由: エージェントが異なるコンテキストでドキュメントを参照しても一貫性を保つため

### 9.2 アンカーリンクの形式

```markdown
[リンクテキスト](/path/to/file.md#section-id)
```

ここで `section-id` は以下のルールで自動生成:
- 英語の見出しテキストは小文字化しスペースをハイフンに置換
- 日本語の見出しは見出し番号を使用 (`#1-2-機能詳細` など)

### 9.3 リスト参照形式

特に参照リストは以下の形式に統一:

```markdown
- **カテゴリ**: [ドキュメント名](/path/to/file.md)
- **カテゴリ**: [ドキュメント名](/path/to/file.md)
```

## 10. まとめ

本ドキュメントで定義された参照関係の設計により、AppGenuis開発プロセスにおけるドキュメント間のナビゲーションが容易になり、AIエージェントと人間の双方が一貫した情報にアクセスできるようになります。この参照システムを適切に維持することで、大規模な開発プロセスでも情報の整合性と追跡可能性が確保されます。
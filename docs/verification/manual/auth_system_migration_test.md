# 認証システム移行テスト計画

## 概要

このテスト計画は、旧認証システム（AuthenticationService）から新認証システム（SimpleAuthService）への移行に伴う変更をテストするためのものです。移行作業はフェーズ分けして行われ、このテスト計画はフェーズ1、2、3の修正に対するテストを対象としています。

## テスト対象の変更

1. `AuthStatusBar.ts` - SimpleAuthServiceのみ参照するよう変更
2. `LogoutNotification.ts` - SimpleAuthServiceを使用するよう変更
3. `PermissionManager.ts` - SimpleAuthServiceのみ使用するよう型定義変更
4. `authCommands.ts` - SimpleAuthServiceを使用するよう変更
5. `extension.ts` - 旧認証システムの初期化コードを削除
6. 旧認証システムファイル（`AuthenticationService.ts`、`TokenManager.ts`）をバックアップして削除

## テスト環境

- VSCode最新バージョン
- AppGenius拡張機能をデバッグモードで実行
- テスト用のSimpleAuthの認証情報

## テスト計画

### 1. 認証ステータス表示テスト

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| AUTH-01  | VSCodeを起動し、AppGeniusを有効化する | ステータスバーに「未ログイン」と表示されること | ステータスバーに正しく表示される |
| AUTH-02  | ログインコマンドを実行してログインする | ステータスバーにユーザー名が表示されること | ユーザー名が正しく表示される |
| AUTH-03  | ログアウトコマンドを実行する | ステータスバーに「未ログイン」と表示されること | 「未ログイン」が正しく表示される |
| AUTH-04  | 認証状態を確認する | コンソールログで`SimpleAuthService`が使用されていることが確認できること | 旧認証システムへの参照が存在しない |

### 2. ログアウト通知テスト

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| LOGOUT-01 | 手動でログアウトする | 標準のログアウト通知が表示されること | 通知が正しく表示される |
| LOGOUT-02 | トークン期限切れをシミュレートする（テストモードで） | 「セッションの有効期限が切れました」と表示されること | 通知が正しく表示される |
| LOGOUT-03 | アカウント削除通知をシミュレートする（テストモードで） | 「アカウントが削除されました」と表示されること | 通知が正しく表示される |

### 3. 権限チェックテスト

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| PERM-01  | 未ログイン状態でスコープマネージャーを開く | ログインプロンプトが表示されること | プロンプトが正しく表示される |
| PERM-02  | 一般ユーザーでログインし、管理者機能にアクセスする | 権限エラーが表示されること | エラーメッセージが正しく表示される |
| PERM-03  | 管理者ユーザーでログインし、管理者機能にアクセスする | 管理者機能にアクセスできること | 機能が正常に利用できる |

### 4. エラー処理テスト

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| ERR-01   | ネットワーク接続がない状態でログインを試みる | 適切なエラーメッセージが表示されること | エラーメッセージが表示される |
| ERR-02   | 不正な認証情報でログインを試みる | ログイン失敗メッセージが表示されること | エラーメッセージが表示される |
| ERR-03   | サーバータイムアウトをシミュレートする（テストモードで） | タイムアウトエラーメッセージが表示されること | エラーメッセージが表示される |

### 5. 拡張機能全体のフロー確認

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| FLOW-01  | ログイン→スコープマネージャー操作→ログアウトの一連のフローを実行 | すべての機能が正常に動作すること | エラーなく操作できる |
| FLOW-02  | ログイン→デバッグ探偵操作→ログアウトの一連のフローを実行 | すべての機能が正常に動作すること | エラーなく操作できる |
| FLOW-03  | ログイン→モックアップギャラリー操作→ログアウトの一連のフローを実行 | すべての機能が正常に動作すること | エラーなく操作できる |

## テストログの出力

テスト実行中は、以下の情報をコンソールに出力するよう`Logger`を構成します：

1. 認証状態の変更
2. SimpleAuthServiceの呼び出し
3. PermissionManagerからの権限チェック
4. エラー発生時の詳細情報

## テスト実行手順

1. VSCodeを起動し、開発者ツールを開く（Help > Toggle Developer Tools）
2. AppGenius拡張機能をデバッグモードで実行
3. コンソールログを監視しながら、各テストケースを順番に実行
4. 想定した結果と実際の結果を記録
5. テスト結果をレポートとしてまとめる

## テスト後の対応

テスト結果に基づいて、必要な修正や追加変更を行います。修正が必要な場合は、以下の順序で対応します：

1. コードを修正
2. 単体テストの実行
3. 該当するテストケースの再テスト
4. 回帰テストの実行

## 次フェーズへの準備

このテスト計画はフェーズ1〜3の修正に対するテストを対象としています。テストが成功した場合、フェーズ4（インターフェース統一 - SimpleAuthServiceをAuthServiceにリネーム）に進むための準備が整います。

## 追加テスト（フェーズ3関連）

### 6. 旧認証システム削除確認

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| DELETE-01 | VSCodeを起動し拡張機能をロード | 旧認証システム関連のエラーが発生しないこと | エラーなくロードされる |
| DELETE-02 | コンパイルエラーの確認 | TypeScriptコンパイルエラーが発生しないこと | コンパイルが成功する |
| DELETE-03 | パッケージのビルド | 正常にビルドが完了すること | ビルドエラーがない |

### 7. パフォーマンス確認

| テストID | テスト内容 | 期待される結果 | 合格基準 |
|----------|------------|----------------|----------|
| PERF-01 | 拡張機能の起動時間測定 | 認証システム削除前より起動時間が改善または同等であること | 起動時間が悪化していない |
| PERF-02 | メモリ使用量の測定 | 認証システム削除前よりメモリ使用量が改善または同等であること | メモリ使用量が悪化していない |